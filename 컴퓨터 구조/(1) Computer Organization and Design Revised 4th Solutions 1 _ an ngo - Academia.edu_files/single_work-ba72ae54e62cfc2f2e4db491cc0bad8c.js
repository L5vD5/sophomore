+function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",function(){i=!0});var s=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(s,e),this},t(function(){t.support.transition=e(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(t){"use strict";function e(e){return this.each(function(){var n=t(this),s=n.data("bs.collapse"),o=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);!s&&o.toggle&&"show"==e&&(e=!e),s||n.data("bs.collapse",s=new i(this,o)),"string"==typeof e&&s[e]()})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};i.VERSION="3.2.0",i.DEFAULTS={toggle:!0},i.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},i.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var i=t.Event("show.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var s=n.data("bs.collapse");if(s&&s.transitioning)return;e.call(n,"hide"),s||n.data("bs.collapse",null)}var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0),this.transitioning=1;var r=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return r.call(this);var a=t.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",t.proxy(r,this)).emulateTransitionEnd(350)[o](this.$element[0][a])}}},i.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return t.support.transition?void this.$element[i](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(350):n.call(this)}}},i.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=t.fn.collapse;t.fn.collapse=e,t.fn.collapse.Constructor=i,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(i){var n,s=t(this),o=s.attr("data-target")||i.preventDefault()||(n=s.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),r=t(o),a=r.data("bs.collapse"),u=a?"toggle":s.data(),l=s.attr("data-parent"),c=l&&t(l);a&&a.transitioning||(c&&c.find('[data-toggle="collapse"][data-parent="'+l+'"]').not(s).addClass("collapsed"),s[r.hasClass("in")?"addClass":"removeClass"]("collapsed")),e.call(r,u)})}(jQuery),function(){this.MobileRegPath||(this.MobileRegPath={}),this.MobileRegPath.notifier=new c.Server.Notification("msutd"),this.MobileRegPath.notifier.notifyAndLog=function(t,e){return null==e&&(e={}),$a.log(t),this.notify({event_type:t,location:null!=e.location?e.location:void 0,attachment_id:null!=e.attachment_id?e.attachment_id:void 0,auvid:$auvid})}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/layout"]=function(t){var e=[],i=t||{};return function(t){e.push('<div id="mobile_reg_path" class="DesignSystem"><div class="full-screen-modal-header u-pv4x u-taCenter"><img'+jade.attr("src",""+t("academia-logo-redesign-2015.svg"),!0,!1)+jade.attr("onerror","this.onerror=null;this.src="+t("academia-logo-redesign-2015.png"),!0,!1)+' class="swp-mobile-signup-modal-header-logo"/><span class="swp-mobile-signup-modal-header-close u-positionAbsolute close-full-screen-modal u-clickable u-fs18 u-tcGrayDark">&times;</span></div><div class="container-fluid"><div class="row"><div class="col-xs-12"><div class="full-screen-modal-page-header u-taCenter u-mv4x"><span class="modal-page-header js-modal-page-header u-fs16"></span></div></div><div class="col-xs-12"><div class="full-screen-modal-page-content u-p0x"></div></div></div></div></div>')}.call(this,"$image_url"in i?i.$image_url:"undefined"!=typeof $image_url?$image_url:void 0),e.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/no_suggested_users"]=function(){var t=[];return t.push('<li class="u-pv8x"><div class="u-fs24 u-tcGray u-lineHeight1_3">None of your friends are on Academia</div></li>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/enter_email_page"]=function(){var t=[];return t.push('<form class="js-mobile-signup-modal-email-form"><input type="email" placeholder="Email" class="js-email TextInput"/><div class="u-mt3x"><input type="submit" disabled="disabled" value="Submit" class="js-submit-email Button Button--block Button--disabled"/></div></form>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/enter_name_page"]=function(){var t=[];return t.push('<form class="js-mobile-signup-modal-final-form"><input type="text" placeholder="First Name" id="user_first_name" class="TextInput js-first-name"/><div class="u-mt3x"><input type="text" placeholder="Last Name" id="user_last_name" class="TextInput js-last-name"/></div><div class="u-mt3x"><input type="password" placeholder="Password" id="user_password" class="TextInput js-password"/></div><div class="u-mt3x"><input type="submit" disabled="disabled" value="Submit" class="js-submit-name Button Button--block Button--green"/></div></form>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/sent_email_page"]=function(){var t=[];return t.push('<div class="u-taCenter u-mb4x"><i class="fa fa-check-circle-o u-tcGreen u-fs16"></i>&nbsp;&nbsp;<span class="u-tcGreen u-fw700 u-fs16">Email Sent</span></div><button class="js-sent-email-finished Button Button--inverseGray Button--mobile-xxl Button--block">Continue Reading</button>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/pages/sent_email_with_fb_page"]=function(){var t=[];return t.push('<div class="u-taCenter"><i class="fa fa-check-circle-o u-tcGreen u-fs16"></i>&nbsp;&nbsp;<span class="u-tcGreen u-fw700 u-fs16">Email Sent</span></div><div class="u-mb6x"><button class="js-swp-mobile-signup-fb-connect Button Button--facebook Button--block u-mt4x"><i class="fa fa-facebook"></i>&nbsp;&nbsp; Find Friends</button></div><div class="js-suggested-academics u-fs20 u-pb6x hidden u-taCenter">Suggested Academics</div><ul class="js-user-suggestions-list swp-mobile-signup-user-suggestions-list list-unstyled"></ul><div class="swp-mobile-signup-close-fb-bar u-p4x u-bgColorWhite js-mobile-follow-all hidden"><button class="js-sent-email-finished Button Button--green Button--lg Button--block">follow all</button></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["mobile_reg_path/templates/suggested_user"]=function(t){var e,i=[],n=t||{};return function(t,n){var s=n.user;i.push('<div class="u-displayFlex u-alignItemsCenter"><img'+jade.attr("src",s.photo,!0,!1)+' class="Avatar Avatar--sm u-mr2x"/><div class="u-flexGrow1 u-textTruncate"><div class="u-fs14 u-textTruncate u-fw700">'+jade.escape(null==(e=s.display_name)?"":e)+'</div><div class="u-fs13 u-textTruncate">'+jade.escape(null==(e=t)?"":e)+'</div></div><div class="u-ml2x"><button'+jade.attr("data-follow-user-id",s.id,!0,!1)+' data-follow-user-source="mobile_signup_to_download"'+jade.attr("style",n.followedByCurrentUser?"display: none":!1,!0,!1)+' class="Button Button Button--green Button--sm u-ph2x">Follow</button><button'+jade.attr("data-unfollow-user-id",s.id,!0,!1)+jade.attr("style",n.followedByCurrentUser?!1:"display: none",!0,!1)+' class="Button Button--inverseGreen Button--sm u-ph2x">Following</button></div></div>')}.call(this,"reason"in n?n.reason:"undefined"!=typeof reason?reason:void 0,"suggestion"in n?n.suggestion:"undefined"!=typeof suggestion?suggestion:void 0),i.join("")}}.call(this),function(){this.MobileRegPath.Layout=Backbone.View.extend({template:"mobile_reg_path/templates/layout",events:{"click .close-full-screen-modal":"closeMobileRegPath","click .js-sent-email-finished":function(){return this.closeMobileRegPath(!1)}},initialize:function(t){return this.container=$("#full-screen-modal"),this.attachment_id=t.attachment_id,this.model=new MobileRegPath.newUser({attachment_id:this.attachment_id,user_source:"mobile_download"}),this.container.html(this.render().el),this.container.fadeIn()},render:function(){return this.$el.html(JST[this.template]()),this.postRender(),this},postRender:function(){return this.ui={$headerText:this.$(".js-modal-page-header"),$pageContent:this.$(".full-screen-modal-page-content")},this.initializePageManager()},resetModel:function(){return this.model=new MobileRegPath.NewUser({attachment_id:this.attachment_id,user_source:"mobile_download"})},closeMobileRegPath:function(t){return null==t&&(t=!0),t&&MobileRegPath.notifier.notifyAndLog("download_closed",{attachment_id:this.attachment_id,location:this.pageManager.currentView.el.id}),this.container.fadeOut(),this.container.html(""),MobileRegPath.close=!1,"sent-email-page"===this.pageManager.currentView.el.id||"sent-email-fb-page"===this.pageManager.currentView.el.id?$(".js-swp-mobile-get-pdf-footer").remove():void 0},steps:function(){return[{viewClass:MobileRegPath.EnterEmailPage,options:{model:this.model}},{viewClass:MobileRegPath.EnterNamePage,shouldSkip:function(t){return function(){return t.skipNamePage()}}(this),options:{model:this.model}},{viewClass:MobileRegPath.SentEmailPage,shouldSkip:function(t){return function(){return t.skipSentEmailPage()}}(this),options:{model:this.model}},{viewClass:MobileRegPath.SentEmailWithFbPage,shouldSkip:function(t){return function(){return t.skipSentEmailFbPage()}}(this),options:{model:this.model}}]},initializePageManager:function(){return this.pageManager=new Academia.RegPath.PageManagerView({el:this.ui.$pageContent,steps:this.steps(),headerText:this.ui.$headerText})},skipNamePage:function(){return MobileRegPath.user_exists||!1},skipSentEmailPage:function(){return MobileRegPath.user_confirmed||!1},skipSentEmailFbPage:function(){return MobileRegPath.user_exists||!MobileRegPath.user_confirmed}})}.call(this),function(){this.MobileRegPath.EnterEmailPage=Backbone.View.extend({id:"email-page",stepNumber:1,headerText:"Enter your email address",template:"mobile_reg_path/templates/pages/enter_email_page",events:{"submit .js-mobile-signup-modal-email-form":"submitEmail","change input.js-email":"toggleSubmitButton","keydown input.js-email":"toggleSubmitButton","keyup input.js-email":"toggleSubmitButton","keydown input.js-email":"logEmailTyping"},initialize:function(){return this.sentLog=!1,this.render()},render:function(){return this.$el.html(JST[this.template]()),this.postRender()},postRender:function(){return $(".js-modal-page-header").html=this.headerText,this.ui={$email:this.$(".js-email"),$submit:this.$(".js-submit-email")},this.ui.$email.focus()},checkEmail:function(){return $.ajax({type:"POST",url:$r.partial_create_registrations_path(),data:{partial_registration:{email:this.model.get("email"),attachment_id:this.model.get("attachment_id")}}})},saveEmail:function(){return this.model.set({email:this.ui.$email.val()})},submitEmail:function(t){return t.preventDefault(),MobileRegPath.notifier.notifyAndLog("attempted_submit_email"),this.saveEmail(),this.checkEmail().done(function(t){return function(e){return e.email_invalid===!0?(alert("Please enter a valid email"),MobileRegPath.notifier.notifyAndLog("validation_failure",{attachment_id:t.model.get("attachment_id"),error:"email_invalid"})):e.user_exists===!0?(MobileRegPath.notifier.notifyAndLog("email_valid",{attachment_id:t.model.get("attachment_id"),location:"existing_user"}),MobileRegPath.user_exists=!0,t.trigger("step_complete")):(MobileRegPath.notifier.notifyAndLog("email_valid",{attachment_id:t.model.get("attachment_id"),location:"new_user"}),MobileRegPath.user_exists=!1,t.trigger("step_complete"))}}(this)).fail(function(){return alert("Something went wrong")})},disableSubmitButton:function(){return this.ui.$submit.attr("disabled",!0).removeClass("Button--green").addClass("Button--disabled")},enableSubmitButton:function(){return this.ui.$submit.removeAttr("disabled").removeClass("Button--disabled").addClass("Button--green")},toggleSubmitButton:function(){return this.ui.$email.val().length>0?this.enableSubmitButton():this.disableSubmitButton()},logEmailTyping:function(){return this.sentLog||MobileRegPath.notifier.notifyAndLog("started_typing",{attachment_id:this.model.get("attachment_id"),location:"user_email"}),this.sentLog=!0}})}.call(this),function(){this.MobileRegPath.EnterNamePage=Backbone.View.extend({id:"name-page",stepNumber:2,headerText:"Enter your name and password",template:"mobile_reg_path/templates/pages/enter_name_page",events:{"submit .js-mobile-signup-modal-final-form":"toNextPage","change input":"toggleSubmitButtonAndLog","keydown input":"toggleSubmitButtonAndLog","keyup input":"toggleSubmitButtonAndLog"},initialize:function(){return this.log={user_first_name:!1,user_last_name:!1,user_password:!1},this.render()},render:function(){return this.$el.html(JST[this.template]()),this.postRender(),this},postRender:function(){return this.ui={$password:this.$(".js-password"),$submit:this.$(".js-submit-name"),$first_name:this.$(".js-first-name"),$last_name:this.$(".js-last-name")},this.ui.$first_name.focus()},saveFields:function(){return this.model.set({password:this.ui.$password.val(),first_name:this.ui.$first_name.val(),last_name:this.ui.$last_name.val()})},generateErrorMessages:function(t){var e;return 0===t.length?"Something went wrong":(e=[],t.forEach(function(t){return"user[display_name]"!==t[0]?e.push(t[1]):void 0}),e.join("\n"))},toNextPage:function(t){return t.preventDefault(),MobileRegPath.notifier.notifyAndLog("attempted_submit"),this.saveFields(),this.model.save().done(function(t){return function(e){var i,n,s;return s=e[0],i=e[1],n=e[2],s?(window.$current_user=JSON.parse(i.user),Aedu.User.set_current($current_user),MobileRegPath.user_confirmed=!Aedu.User.current.unconfirmed,t.trigger("step_complete")):(MobileRegPath.notifier.notifyAndLog("validation_failure",{error:JSON.stringify(n)}),alert(t.generateErrorMessages(n)))}}(this)).fail(function(){return alert("Something went wrong")})},disableSubmitButton:function(){return this.ui.$submit.attr("disabled",!0).removeClass("Button--green").addClass("Button--disabled")},enableSubmitButton:function(){return this.ui.$submit.removeAttr("disabled").removeClass("Button--disabled").addClass("Button--green")},toggleSubmitButtonAndLog:function(t){return this.ui.$password.val().length>0&&this.ui.$first_name.val().length>0&&this.ui.$last_name.val().length>0?this.enableSubmitButton():this.disableSubmitButton(),this.log[t.target.id]?void 0:(MobileRegPath.notifier.notifyAndLog("started_typing",{location:t.target.id}),this.log[t.target.id]=!0)}})}.call(this),function(){this.MobileRegPath.SentEmailPage=Backbone.View.extend({id:"sent-email-page",stepNumber:3,headerText:" ",template:"mobile_reg_path/templates/pages/sent_email_page",initialize:function(){return this.render()},render:function(){return this.$el.html(JST[this.template]()),this}})}.call(this),function(){this.MobileRegPath.SentEmailWithFbPage=Backbone.View.extend({id:"sent-email-fb-page",stepNumber:3,headerText:" ",template:"mobile_reg_path/templates/pages/sent_email_with_fb_page",events:{"click .js-swp-mobile-signup-fb-connect":"connectFB","click .js-sent-email-finished":"toNextPage"},initialize:function(){return this.suggestedUsers=new Academia.RegPath.SuggestedUsers,this.render()},connectFB:function(){var t,e;return e=function(t){return Facebook.register_connected(t)},t=function(){var t;return t=$r.api_v0_user_following_index_path({user_id:$current_user.id,subdomain_param:"api"}),$.getJSON(t)},Facebook.authorize().then(e).then(t).done(function(t){return function(e){var i,n,s,o;for(s=e.following,i=0,n=s.length;n>i;i++)o=s[i],Aedu.User.current.record_follow_of(o.id);return t.suggestedUsers.fetch(),t.disableFacebookButton(),alert("Facebook connect success")}}(this)).fail(function(){return alert("Facebook connect fail")})},render:function(){return this.$el.html(JST[this.template]()),this.postRender()},postRender:function(){return this.userSuggestionsView=new MobileRegPath.SuggestedUserListView({collection:this.suggestedUsers})},toNextPage:function(){return this.suggestedUsers.save(),this.trigger("step_complete")},disableFacebookButton:function(){return $(".js-swp-mobile-signup-fb-connect").removeClass("Button--facebook").addClass("Button--disabled").attr("disabled",!0).html("<i class='fa fa-facebook'></i>&nbsp;&nbsp; connected")}})}.call(this),function(){this.MobileRegPath.SuggestedUserView=Backbone.View.extend({tagName:"li",className:"u-borderTop1 u-borderColorGray u-pt2x u-mt2x",template:"mobile_reg_path/templates/suggested_user",initialize:function(){var t;return t=$a.is_logged_in()&&(Aedu.User.current.follows(this.model.get("user").id)||0===this.model.get("sources").length||_.contains(this.model.get("sources"),"AuthorsBookmarked")),this.model.set("followedByCurrentUser",t),this.render()},render:function(){return this.$el.html(JST[this.template]({suggestion:this.model.toJSON(),reason:this.reason(this.model.get("sources"))})),this},reason:function(t){var e,i;return _.contains(t,"Owner")?"Author":_.contains(t,"AuthorsBookmarked")?"Co-Author":0===t.length?"Facebook Friend":(i=this.model.get("user"),"independant"!==i.domain_name&&i.department?i.department.university.name:i.interests.length>0?(e=_.chain(i.interests).first(3).pluck("name").value(),$h.to_sentence(e)):"Independent Researcher")}})}.call(this),function(){this.MobileRegPath.SuggestedUserListView=Backbone.View.extend({el:$("ul.js-user-suggestions-list"),initialize:function(){return this.changeButton=!0,this.listenTo(this.collection,"sync",function(t){return function(){var e;return e=t.collection.filter(function(t){return MobileRegPath.author===t.get("user").id&&t.get("sources").push("Owner"),_.contains(MobileRegPath.workCoauthors,t.get("user").id)&&t.get("sources").push("AuthorsBookmarked"),!0}),t.collection.reset(e),t.collection.length>0?(t.collection.each(function(e){return t.addUser(e),t.changeButton?t.changeButton=t.checkSource(e):void 0}),t.showFollowAllButton(),t.changeButton?t.changeFollowAllToContinue():void 0):t.noResults()}}(this))},addUser:function(t){var e;return e=new MobileRegPath.SuggestedUserView({model:t}),$(this.$el.selector).append(e.el)},noResults:function(){return $(this.$el.selector).append(JST["mobile_reg_path/templates/no_suggested_users"])},showFollowAllButton:function(){return $(".js-mobile-follow-all").removeClass("hidden"),$(".js-suggested-academics").removeClass("hidden")},changeFollowAllToContinue:function(){return $(".js-sent-email-finished").removeClass("Button--green").addClass("Button--inverseGray").text("continue")},checkSource:function(t){return _.contains(t.get("sources"),"AuthorsBookmarked")||0===t.get("sources").length}})}.call(this),function(){this.MobileRegPath.newUser=Backbone.Model.extend({save:function(){return this.savingToServer?void 0:(this.savingToServer=!0,$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:$r.registrations_path(),data:this.dataForSave(),complete:function(t){return function(){return t.savingToServer=!1}}(this)}))},dataForSave:function(){var t;return t={user:{email:this.get("email"),first_name:this.get("first_name"),last_name:this.get("last_name"),password:this.get("password")},doc_id:this.get("attachment_id"),user_source:this.get("user_source"),splash:this.get("splash"),login_redirect:this.get("login_redirect")},JSON.stringify(t)}})}.call(this),function(){this.SingleWork={preview_controller:null,register_preview_view:function(t,e){return this.preview_controller.register_view(t,e)},show_preview:function(t){return this.preview_controller.show(t)}}}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.AttachmentPreviewController=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click .js-preview-attachment-button[data-preview-attachment-id]":"previewLinkClicked"},i.prototype.initialize=function(t){var e;return t.attachment&&(this.attachment=t.attachment,this.updateUI()),t.multiple_viewable_attachments?(e=this,new HoverPopover({el:".js-viewable-attachments-button",show_delay:200,hide_delay:300,html:!0,content:this.getPopoverContent,on_shown:function(){return e.$popover_el=this.$el}})):void 0},i.prototype.previewLinkClicked=function(t){var e;return e=$(t.currentTarget).data("preview-attachment-id"),this.attachment.id!==e?(this.attachment.id=e,this.attachment.index=$(t.currentTarget).data("preview-attachment-index"),this.updateUI()):void 0},i.prototype.updateUI=function(){return SingleWork.show_preview(this.attachment.id),this.$(".js-preview-attachment-button[data-preview-attachment-id] .js-active-attachment-preview").removeClass("active-preview"),$(".js-work-download-button-container[data-preview-attachment-id]").addClass("hidden"),this.$(".js-preview-attachment-button[data-preview-attachment-id='"+this.attachment.id+"'] .js-active-attachment-preview").addClass("active-preview"),$(".js-work-download-button-container[data-preview-attachment-id='"+this.attachment.id+"']").removeClass("hidden"),this.$(".js-viewable-attachments-preview-index").text(this.attachment.index+1)},i.prototype.getPopoverContent=function(){return $(".js-viewable-attachments-popover-content").html()},i}(Backbone.View)}.call(this),function(){SingleWork.CoauthorTagApi=function(){function t(){}return t.accept=function(t,e){return this._setAccepted(t,e,!0)},t.ignore=function(t,e){return this._setAccepted(t,e,!1)},t.reset=function(t,e){return this._setAccepted(t,e,null)},t._setAccepted=function(t,e,i){return $.ajax({type:"PUT",dataType:"json",contentType:"application/json",url:$r.api_v0_work_co_author_tag_path({subdomain_param:"api",id:t,work_id:e}),data:JSON.stringify({accepted:i,coauthor_invite:this._tokenFromUrl()})})},t._tokenFromUrl=function(){return $a.query_param("coauthor_invite")},t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.CoauthorTagIgnoreModal=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click #coauthor-tag-undo-ignore":"undoIgnore"},i.prototype.show=function(){return this.$el.modal("show"),this},i.prototype.render=function(){return this.$el.modal({show:!1}),this},i.prototype.undoIgnore=function(){return this.$el.modal("hide"),SingleWork.CoauthorTagApi.reset(this.options.tag_id,this.options.work_id),SingleWork.ExternalCoauthorTagModal.open(this.options.tag_id,this.options.work_id)},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.CoauthorTagToolbar=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.id="coauthor-tag-request-toolbar",i.prototype.template="single_work/templates/coauthor_request_toolbar_ds",i.prototype.className="row coauthor-tag-request-toolbar-ds DesignSystem alert clearfix",i.prototype.events={"click .js-ignore-coauthor-tag-request":"ignoreCoauthorRequest","click .js-accept-coauthor-tag-request":"acceptCoauthorRequest"},i.prototype.initialize=function(t){return this.options=t},i.prototype.render=function(){return this.$el.html(JST[this.template]()),this},i.prototype.close=function(){return $(".work-body-wrapper").removeClass("coauthor-toolbar-present"),this.remove()},i.prototype.alertSuccess=function(){return this.$el.removeClass("alert-warning alert-danger"),this.$el.addClass("alert-success text-center"),this.$(".coauthor-tag-request-prompt").text("You have successfully been added as a co-author!"),this.hideActions()},i.prototype.alertError=function(){return this.$el.removeClass("alert-warning"),this.$el.addClass("alert-danger"),this.$(".coauthor-tag-request-prompt").text("Oops! We encountered an error and failed to process your request.")},i.prototype.hideActions=function(){return this.$(".js-coauthor-ignore").hide(),this.$(".js-coauthor-accept").hide(),this.$(".js-coauthor-msg").removeClass("col-xs-9").addClass("col-xs-12").addClass("u-taCenter")},i.prototype.acceptCoauthorRequest=function(){},i.prototype.ignoreCoauthorRequest=function(){},i}(Backbone.View)}.call(this),function(){SingleWork.CsvView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.attachment_id=t.attachment_id,this.$container=$(this.container),this.content=null}return t.prototype.show=function(){var t;return this.$container.find(".info_box").hide(),this.$container.find(".csv_preview_loader").show(),null!==this.content?this.$container.html(this.content):(t=$r.attachment_csv_preview_path({attachment_id:this.attachment_id}),$.ajax({url:t,dataType:"json",success:function(t){return function(e){return t.content=e.content,t.$container.html(t.content)}}(this),error:function(t){return function(){return t.$container.find(".csv_preview_loader").hide(),t.$container.find(".info_box").show()}}(this)}))},t}()}.call(this),$(".js-swp-view-discussion-tooltip").tooltip({placement:function(){var t=$(window).scrollTop(),e=$(".js-swp-view-discussion-tooltip").offset().top,i=e-t,n=32;return i>n?"top":"bottom"}}),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.ExternalCoauthorTagModal=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.open=function(t,e,i,n){var s,o;return s=new SingleWork.ExternalCoauthorTagModal({el:".js-coauthor-invite-modal",tag_id:t,work_id:e,coauthor:i,abTestsHash:n}),s.render().show(),o=new SingleWork.ExternalCoauthorTagToolbar({tag_id:t,work_id:e,ab_tests_hash:n}),$(".work-body-wrapper").prepend(o.render().el)},i.prototype.events={"click .js-coauthor-invite-accept-button":"acceptCoauthorRequest"},i.prototype.initialize=function(){return this.abTestsHash=this.options.abTestsHash,this.notify("external_coauthor_invite_modal_render"),i.__super__.initialize.apply(this,arguments),this.coauthor=this.options.coauthor},i.prototype.show=function(){return this.$el.modal("show"),this},i.prototype.render=function(){return this.$el.modal({show:!1}),this.postRender(),this},i.prototype.postRender=function(){return this.ui={$acceptButtonText:this.$(".js-coauthor-invite-accept-text"),$acceptButtonSpinner:this.$(".js-coauthor-invite-accept-spinner")}},i.prototype.showSignupModal=function(t){return this.notify("external_coauthor_invite_verify_modal_render",{reason:t}),this.$el.modal("hide"),$(".coauthor-verify-modal").modal("show")},i.prototype.acceptCoauthorRequest=function(){var t;return this.notify("external_coauthor_invite_accept",{location:"modal"}),(null!=(t=this.coauthor)?t.eligibleForAutoRegister():void 0)?this.autoRegisterUser():this.showSignupModal("one_click_ineligible")},i.prototype.autoRegisterUser=function(){return this.showAcceptSpinner(),this.coauthor.autoRegister().fail(function(t){return function(){return t.hideAcceptSpinner(),t.showSignupModal("error_fallback")}}(this))},i.prototype.hideAcceptSpinner=function(){return this.ui.$acceptButtonText.removeClass("hidden"),this.ui.$acceptButtonSpinner.addClass("hidden")},i.prototype.showAcceptSpinner=function(){return this.ui.$acceptButtonText.addClass("hidden"),this.ui.$acceptButtonSpinner.removeClass("hidden")},i.prototype.alertSuccess=function(){return this.$el.removeClass("alert-warning alert-danger"),this.$el.addClass("alert-success text-center"),this.$(".coauthor-tag-request-prompt").text("You have successfully been added as a co-author!"),this.hideActions()},i.prototype.alertError=function(){return this.$el.removeClass("alert-warning"),this.$el.addClass("alert-danger"),this.$(".coauthor-tag-request-prompt").text("Oops! We encountered an error and failed to process your request.")},i.prototype.notify=function(t,e){var i;return null==e&&(e={}),i=new c.Server.Notification("coauthors_flow"),i.notify(_.extend({},e,{event:t,work_id:this.options.work_id,tag_id:this.options.tag_id,ab_tests:this.abTestsHash}))},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.ExternalCoauthorTagToolbar=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.acceptCoauthorRequest=function(){return this.notify("external_coauthor_invite_accept",{location:"toolbar"}),this.showSignupModal()},i.prototype.ignoreCoauthorRequest=function(){return SingleWork.CoauthorTagApi.ignore(this.options.tag_id,this.options.work_id),this.close()},i.prototype.showSignupModal=function(){return $(".coauthor-verify-modal").modal("show")},i.prototype.render=function(){return UserSource.remember("coauthor_invite"),this.notify("external_coauthor_invite_toolbar_render"),i.__super__.render.apply(this,arguments)},i.prototype.notify=function(t,e){var i;return null==e&&(e={}),i=new c.Server.Notification("coauthors_flow"),i.notify({event:t,work_id:this.options.work_id,tag_id:this.options.tag_id,location:null!=e.location?e.location:void 0,ab_tests:this.options.ab_tests_hash})},i}(SingleWork.CoauthorTagToolbar)}.call(this),function(){SingleWork.IFrameView=function(){function t(t){this.container=t.container,this.identifier=t.identifier,this.$container=$(this.container)}return t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.InternalCoauthorTagToolbar=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.autoAccept=function(){return this.acceptCoauthorRequest()},i.prototype.acceptCoauthorRequest=function(){return $a.is_logged_in()?SingleWork.CoauthorTagApi.accept(this.options.tag_id,this.options.work_id).done(function(t){return function(){return t.alertSuccess()}}(this)).fail(function(t){return function(){return t.alertError()}}(this)):$("#nav_log_in").click()},i.prototype.ignoreCoauthorRequest=function(){return $a.is_logged_in()?SingleWork.CoauthorTagApi.ignore(this.options.tag_id,this.options.work_id).done(function(t){return function(){return t.close()}}(this)).fail(function(t){return function(){return t.alertError()}}(this)):$("#nav_log_in").click()},i}(SingleWork.CoauthorTagToolbar)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.PendingExternalCoauthor=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return UserSource.remember("coauthor_invite"),i.__super__.initialize.apply(this,arguments)},i.prototype.eligibleForAutoRegister=function(){return this.get("allow_one_click_register")&&this.get("first_name")&&this.get("last_name")&&this.get("email")&&this.get("token")},i.prototype.autoRegister=function(){var t;return t=new $.Deferred,$.ajax({type:"POST",url:"/registrations",data:{user:{first_name:this.get("first_name"),last_name:this.get("last_name"),email:this.get("email")},no_password:!0,coauthor_token:this.get("token"),coauthor_work:this.get("work_id"),user_source:"coauthor_invite"},dataType:"json",xhrFields:{withCredentials:!0}}).done(function(){return function(e){var i,n,s;
return s=e[0],i=e[1],n=e[2],s?(t.resolve(),document.location.href="/StartRegPath"):t.reject()}}(this)).fail(function(){return function(){return t.reject()}}(this)),t},i}(Backbone.Model)}.call(this),function(){SingleWork.PreviewController=function(){function t(){this.views={},this.current_identifier=null}return t.prototype.show=function(t){return this.current_identifier&&this._hide_view(this.current_identifier),this.current_identifier=t,this._show_view(t)},t.prototype.register_view=function(t,e){if(null!=this.views[t])throw"Can't register multiple views for the same identifier!";return this.views[t]=e,this.current_identifier===t?this._show_view(t):void 0},t.prototype._show_view=function(t){var e;return this._view_container(t).show(),null!=(e=this.views[t])&&"function"==typeof e.show?e.show():void 0},t.prototype._hide_view=function(t){var e;return null!=(e=this.views[t])&&"function"==typeof e.tear_down&&e.tear_down(),this._view_container(t).hide()},t.prototype._view_container=function(t){return $(".attachment_preview[data-attachment="+t+"]")},t}(),SingleWork.preview_controller=new SingleWork.PreviewController}.call(this),Aedu.SingleWork=Aedu.SingleWork||{},Aedu.SingleWork.PostDownloadBookmarkPanel=React.createClass({displayName:"PostDownloadBookmarkPanel",propTypes:{workId:React.PropTypes.number.isRequired,alreadyBookmarked:React.PropTypes.bool.isRequired,shouldAutoBookmark:React.PropTypes.bool.isRequired,collapsed:React.PropTypes.bool},getInitialState:function(){return{isBookmarked:this.props.shouldAutoBookmark,showsBookmark:!this.props.alreadyBookmarked}},setBookmarkId:function(t){var e=null!=t;Aedu.swpData.set({bookmarkedByUser:e}),this.setState({isBookmarked:e,bookmarkId:t})},applyBookmark:function(){var t={bookmark:{content_id:this.props.workId,content_type:"Work",source:"download",from_download_at:Math.floor((new Date).getTime()/1e3)}};$.ajax({type:"POST",dataType:"json",url:$r.api_v0_bookmarks_path({subdomain_param:"api"}),data:t}).done(function(t){this.setBookmarkId(t.bookmark.id)}.bind(this)).fail(function(){}.bind(this))},undoBookmark:function(){null!=this.state.bookmarkId&&$.ajax({type:"DELETE",dataType:"json",url:$r.api_v0_bookmark_path({subdomain_param:"api",id:this.state.bookmarkId}),data:{id:this.state.bookmarkId}}).done(function(){this.setBookmarkId(null)}.bind(this)).fail(function(){}.bind(this))},toggleBookmark:function(){this.state.isBookmarked?this.undoBookmark():this.applyBookmark()},componentWillMount:function(){this.collapseInfoPanel=function(){this.setState({collapsed:!0})}.bind(this),this.props.shouldAutoBookmark&&this.applyBookmark()},render:function(){return React.createElement("div",{className:"DesignSystem"},this.downloadStartedPanel(),this.savedToBookmarksPanel(),React.createElement("hr",{className:"transition-hide-up u-overflowHidden",style:{height:this.props.collapsed?0:"1px",opacity:this.props.collapsed?0:1,marginTop:this.props.collapsed?0:"20px",marginBottom:this.props.collapsed?0:"20px"}}))},downloadStartedPanel:function(){return React.createElement("div",{className:"transition-hide-up u-overflowHiddenx",style:{height:this.props.collapsed?0:"48px",opacity:this.props.collapsed?0:1,marginBottom:this.props.collapsed||!this.state.showsBookmark?0:"16px"}},React.createElement("div",{className:"clearfix alert alert-success u-fw400 u-tcGreen u-fs13 u-pv3x u-ph4x u-bgColorGreenLightest u-borderColorGreenLighter"},React.createElement("div",{className:"fa fa-check u-mr2x"}),"Your download has started"))},savedToBookmarksPanel:function(){if(this.props.alreadyBookmarked)return React.createElement("div",null);var t=null;return t=this.state.isBookmarked?this.bookmarkUndoPanel():this.bookmarkRedoPanel(),React.createElement("div",{className:"transition-hide-up u-overflowHidden",style:{height:this.props.collapsed?0:"48px",opacity:this.props.collapsed?0:1}},t)},bookmarkUndoPanel:function(){return React.createElement("div",{className:"clearfix alert alert-info u-fw400 u-tcBlue u-fs13 u-pv3x u-ph4x u-bgColorBlueLightest u-borderColorBlueLighter"},React.createElement("div",{className:"pull-left"},React.createElement("div",{className:"fa fa-bookmark u-mr2x"}),"Saved to your public bookmarks."),React.createElement("div",{className:"pull-right clickable u-tcBlueLighter",onClick:this.toggleBookmark},"Undo"))},bookmarkRedoPanel:function(){return React.createElement("div",{className:"clearfix alert alert-info u-fw400 u-tcBlue u-fs13 u-pv3x u-ph4x u-bgColorBlueLightest u-borderColorBlueLighter"},React.createElement("div",{className:"pull-left"},React.createElement("div",{className:"fa fa-bookmark u-mr2x"}),"Save to your public bookmarks."),React.createElement("div",{className:"pull-right clickable text-uppercase u-fw500",onClick:this.toggleBookmark},"bookmark"))}}),Aedu.SingleWork=Aedu.SingleWork||{},Aedu.SingleWork.PostDownloadModal=React.createClass({displayName:"PostDownloadModal",propTypes:{readerMessageDeliveredHandler:React.PropTypes.func},getInitialState:function(){return state=this.getDataState(),state.collapsed=!1,state},componentWillMount:function(){this.collapseInfoPanel=function(){this.setState({collapsed:!0})}.bind(this)},getDataState:function(){var t=Aedu.swpData.toJSON();return{workId:t.work.work.id,attachmentId:t.downloadableAttachments[0].attachment.id,owner:t.owner,alreadyBookmarked:t.bookmarkedByUser,shouldAutoBookmark:t.bookmarkOnDownload&&!t.bookmarkOnPageOpen&&!t.bookmarkedByUser}},render:function(){return React.createElement("div",{className:"DesignSystem"},React.createElement(Components.Modals.BodyClose,null,React.createElement("div",{className:"u-p10x"},React.createElement(Aedu.SingleWork.PostDownloadBookmarkPanel,{workId:this.state.workId,alreadyBookmarked:this.state.alreadyBookmarked,shouldAutoBookmark:this.state.shouldAutoBookmark,collapsed:this.state.collapsed}),this.readerMessageOrFollowPanel())))},readerMessageOrFollowPanel:function(){var t=!0;return t?React.createElement(Aedu.SingleWork.ReaderMessagePanel,{workId:this.state.workId,attachmentId:this.state.attachmentId,owner:this.state.owner,onInputStart:this.collapseInfoPanel,readerMessageDeliveredHandler:this.props.readerMessageDeliveredHandler}):this.followPanel()},followPanel:function(){return React.createElement("div",null,"Follow panel")}}),Aedu.SingleWork=Aedu.SingleWork||{},Aedu.SingleWork.ReaderMessagePanel=React.createClass({displayName:"ReaderMessagePanel",propTypes:{workId:React.PropTypes.number,attachmentId:React.PropTypes.number,onInputStart:React.PropTypes.func,owner:React.PropTypes.object,readerMessageDeliveredHandler:React.PropTypes.func},getDefaultProps:function(){return{onInputStart:function(){},readerMessageDeliveredHandler:function(){}}},getInitialState:function(){return{disabled:!1,invalidOccupation:!1,invalidReaderMessage:!1,sendingReaderMessage:!1}},componentWillMount:function(){var t=function(){this.props.readerMessageDeliveredHandler&&(Aedu.swpData.set({leftReaderMessage:!0}),this.props.readerMessageDeliveredHandler())}.bind(this),e=function(){alert("Something went wrong")}.bind(this),i=function(t){return null==t||""==t.trim()}.bind(this),n=function(t){return null==t||""==t.trim()}.bind(this);this.submitReaderMessage=function(){if(!this.state.disabled){var s=this.refs.occupation.getDOMNode().value.trim(),o=this.refs.readerMessage.getDOMNode().value.trim(),r=i(s),a=n(o);if(r||a)return void this.setState({invalidOccupation:r,invalidReaderMessage:a});this.setState({disabled:!0,sendingReaderMessage:!0,invalidReaderMessage:!1,invalidOccupation:!1}),console.log(s,o,this.props.attachmentId,this.props.workId),$.ajax({type:"POST",dataType:"json",url:$r.api_v0_reader_messages_path({subdomain_param:"api"}),data:{occupation:{name:s},message:o,attachment_id:this.props.attachmentId,work_id:this.props.workId,source:"swp_logged_in"}}).done(function(i){i.success?t():e()}).fail(function(t){var i=JSON.parse(t.responseText);e(i.errors)})}}.bind(this)},render:function(){return React.createElement("div",null,this.authorPreview(),React.createElement("br",null),this.occupation(),React.createElement("br",null),this.reasonToDownload(),React.createElement("br",null),this.sendButton())},authorPreview:function(){var t=React.createElement("div",{className:"u-fs16 u-fw400 u-tcGrayDarker"},"Tell ",React.createElement("div",{className:"u-fw700 u-displayInline"}," ",this.props.owner.first_name," "),"about your interest in their research");return React.createElement("div",null,React.createElement(Components.Application.User.ProfilePreviewLabel,{profile:this.props.owner,label:t}))},occupation:function(){var t="TextInput TextInput--lg";return t+=this.state.invalidOccupation?" TextInput--error a-horizontalShake":"",React.createElement("input",{type:"text",className:t,placeholder:"Your Occupation",ref:"occupation",onFocus:this.props.onInputStart})},reasonToDownload:function(){var t="TextArea";return t+=this.state.invalidReaderMessage?" TextInput--error a-horizontalShake":"",React.createElement("div",{className:"clearfix"},React.createElement("textarea",{className:t,placeholder:"What is this paper helping you with?",rows:"4",ref:"readerMessage",onFocus:this.props.onInputStart}))},sendButton:function(){return React.createElement("button",{className:"Button Button--blue Button--block Button--lg",onClick:this.submitReaderMessage},this.sendButtonContents())},sendButtonContents:function(){return this.state.sendingReaderMessage?React.createElement("div",{className:"fa fa-spinner fa-spin"}):"Send"}}),function(){SingleWork.RepoView=function(){function t(t){this._set_repo_widths(),_.each(this.constructor_options,function(e){return function(i){return e[i]=t[i]}}(this)),this.$container=$(this.container)}return t.prototype.constructor_options=["container","user","repo","identifier"],t.prototype.defaults={expanded:"966px",unexpanded:"760px"},t.prototype.show=function(){return $a.ie8()?this.unsupported_browser():req("repo",function(t){return function(){return t.$container.append("<div class='inner_repo'></div>"),t.$repo=t.$container.find(".inner_repo"),t.$repo.width(t.defaults.unexpanded),t.$repo.repo({user:t.user,name:t.repo}),t.$repo.on("not_found",function(){return t.not_found()}),t.$repo.on("api_limited",function(){return t.api_limited()})}}(this))},t.prototype.not_found=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".not_found").show()},t.prototype.api_limited=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".api_limited").show()},t.prototype.unsupported_browser=function(){var t;return null!=(t=this.$repo)&&t.find(".repo").hide(),this.$container.find(".unsupported_browser").show()},t.prototype.tear_down=function(){return this.$repo.remove()},t.prototype._set_repo_widths=function(){var t;return t=$.trim($("#site").attr("class").replace("fixed","")),"w_1160"===t?(this.defaults.expanded="1060px",this.defaults.unexpanded="880px"):"w_1340"===t?(this.defaults.expanded="1246px",this.defaults.unexpanded="1050px"):"w_1780"===t?(this.defaults.expanded="1680px",this.defaults.unexpanded="1500px"):void 0},t}()}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/coauthor_request_toolbar"]=function(){var t=[];return t.push('<span class="coauthor-tag-request-prompt">You have been tagged as a co-author!</span><div class="coauthor-tag-request-actions pull-right"><span class="js-ignore-coauthor-tag-request ignore-coauthor-tag-request clickable">IGNORE</span><button class="js-accept-coauthor-tag-request btn btn-lg btn-success accept-coauthor-tag-request u-textUppercase">ACCEPT</button></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/coauthor_request_toolbar_ds"]=function(){var t=[];return t.push('<div style="line-height:44px" class="js-coauthor-msg col-xs-9 u-fs14 u-fw700"><span>You have been tagged as a co-author!</span></div><div style="line-height:44px" class="js-coauthor-ignore col-xs-1 u-tcGray"><div class="js-ignore-coauthor-tag-request ignore-coauthor-tag-request clickable">IGNORE</div></div><div class="js-coauthor-accept col-xs-2"><button class="js-accept-coauthor-tag-request Button Button--green Button--block accept-coauthor-tag-request"><span>ACCEPT</span></button></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/facebook_connect_with_dismiss"]=function(t){var e,i=[],n=t||{};return function(t,n,s){i.push('<div class="DesignSystem"><div class="modal js-inactive-user-facebook-connect"><div class="modal-dialog"><div class="modal-content swp-facebook-modal-content"><div class="modal-header u-p6x"><button aria-label="Close" data-dismiss="modal" type="button" class="close"><span aria-hidden="true" class="close-icon">\xd7</span></button><h3 class="modal-title u-taCenter">'+jade.escape(null==(e=n)?"":e)+'</h3></div><div class="modal-body u-p10x"><p class="u-mt0x u-mb8x">To access "'+jade.escape(null==(e=s)?"":e)+'," log in below</p><div class="row"><div class="col-md-6 col-md-offset-3"><button class="js-fb-button Button Button--facebook Button--lg Button--block u-p0x u-mv6x"><i class="fa fa-lg fa-facebook-square"></i><span class="u-fs11">&nbsp;&nbsp;'+jade.escape(null==(e=t)?"":e)+"</span></button></div></div></div></div></div></div></div>")}.call(this,"buttonText"in n?n.buttonText:"undefined"!=typeof buttonText?buttonText:void 0,"headerText"in n?n.headerText:"undefined"!=typeof headerText?headerText:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["single_work/templates/splash_single_step_signup_form"]=function(t){var e,i=[],n=t||{};return function(t,n){i.push('<div class="a-fadeInDown"><div class="u-taCenter u-mb2x"><h4 class="u-tcGrayDarker u-fw700">Sign Up to Download</h4></div>'),i.push(n?'<div class="container-fluid u-mv6x"><div class="row"><div class="col-xs-8 col-xs-offset-2"><div class="row"><div class="col-xs-6 u-pl0x u-pr1x"><div class="google-button-connect"><button class="js-swp-splash-single-step-signup-google-button Button Button--google Button--lg Button--block u-p0x"><i class="fa fa-lg fa-google-plus"></i><span>&nbsp;&nbsp;Connect</span></button></div></div><div class="col-xs-6 u-pr0x u-pl1x"><div class="facebook-button-connect"><button class="js-swp-splash-single-step-signup-facebook-button Button Button--facebook Button--lg Button--block u-p0x"><i class="fa fa-lg fa-facebook-square"></i><span>&nbsp;&nbsp;Connect</span></button></div></div></div></div></div></div><div class="container-fluid"><div class="row"><div class="col-xs-8 col-xs-offset-2 u-ph0x"><div class="hr-heading login-hr-heading u-mb6x"><span class="hr-heading-text">or</span></div></div></div></div><form class="js-swp-splash-single-step-signup-form container-fluid"><div class="row"><div class="col-xs-8 col-xs-offset-2"><div class="row u-mb4x"><div class="col-xs-12 u-ph0x"><input placeholder="Email" type="email" id="user_email" class="TextInput TextInput--xl js-swp-splash-single-step-signup-email swp-splash-single-step-singup-input"/></div></div><div class="row"><div class="col-xs-12 collapse js-swp-splash-signup-email-form-collapsed"><div class="row u-mb4x"><div class="col-xs-6 u-pl0x u-pr2x"><input placeholder="First Name" id="user_first_name" class="TextInput TextInput--xl js-swp-splash-single-step-signup-first-name swp-splash-single-step-singup-input"/></div><div class="col-xs-6 u-pl2x u-pr0x"><div class="u-positionRelative"><input placeholder="Last Name" id="user_last_name" class="TextInput TextInput--xl js-swp-splash-single-step-signup-last-name swp-splash-single-step-singup-input"/></div></div></div><div class="row u-mb4x"><div class="col-xs-12 u-ph0x"><input type="password" placeholder="Password" id="user_password" class="TextInput TextInput--xl js-swp-splash-single-step-signup-password swp-splash-single-step-singup-input"/></div></div><div class="row"><div class="col-xs-12 u-ph0x"><button type="submit" data-broccoli-component="sutd-work-splash-signup-button" class="swp-splash-signup-submit Button Button--block Button--lg Button--green"><i'+jade.cls(["fa","fa-lg","fa-"+("pdf"===t?"file-pdf-o":"file-text-o")],[null,null,!0])+"></i>&nbsp;&nbsp;\nGET "+jade.escape(null==(e="pdf"===t?"PDF":"FILE")?"":e)+'</button></div></div></div></div><div class="row"><div class="col-xs-12 u-ph0x u-taCenter"><div class="u-tcGrayDark u-pt2x">Already have an account?\n&nbsp;<a href="/login" class="u-linkUnstyled u-textDecorationUnderline">Sign in</a></div></div></div></div></div></form>':'<form class="js-swp-splash-single-step-signup-form container-fluid u-mt8x"><div class="row"><div class="col-xs-8 col-xs-offset-2"><div class="row u-mb4x"><div class="col-xs-6 u-pl0x u-pr2x"><input placeholder="First Name" id="user_first_name" class="TextInput TextInput--xl js-swp-splash-single-step-signup-first-name swp-splash-single-step-singup-input"/></div><div class="col-xs-6 u-pl2x u-pr0x"><div class="u-positionRelative"><input placeholder="Last Name" id="user_last_name" class="TextInput TextInput--xl js-swp-splash-single-step-signup-last-name swp-splash-single-step-singup-input"/></div></div></div><div class="row u-mb4x"><div class="col-xs-12 u-ph0x"><input placeholder="Email" type="email" id="user_email" class="TextInput TextInput--xl js-swp-splash-single-step-signup-email swp-splash-single-step-singup-input"/></div></div><div class="row u-mb4x"><div class="col-xs-12 u-ph0x"><input type="password" placeholder="Password" id="user_password" class="TextInput TextInput--xl js-swp-splash-single-step-signup-password swp-splash-single-step-singup-input"/></div></div><div class="row"><div class="col-xs-12 u-ph0x"><button type="submit" data-broccoli-component="sutd-work-splash-signup-button" class="swp-splash-signup-submit Button Button--block Button--lg Button--green"><i'+jade.cls(["fa","fa-lg","fa-"+("pdf"===t?"file-pdf-o":"file-text-o")],[null,null,!0])+"></i>&nbsp;&nbsp;\nGET "+jade.escape(null==(e="pdf"===t?"PDF":"FILE")?"":e)+'</button></div></div><div class="row"><div class="col-xs-12 u-ph0x u-taCenter"><div class="u-tcGrayDark u-pt2x">Already have an account?\n&nbsp;<a href="/login" class="u-linkUnstyled u-textDecorationUnderline">Sign in</a></div></div></div></div></div></form>'),i.push("</div>")}.call(this,"attachment_type"in n?n.attachment_type:"undefined"!=typeof attachment_type?attachment_type:void 0,"show_oauth_buttons"in n?n.show_oauth_buttons:"undefined"!=typeof show_oauth_buttons?show_oauth_buttons:void 0),i.join("")}}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.VerifyFulltextModal=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.workId=t.workId,this.attachmentId=t.attachmentId,this.notifier=new Aedu.Server.Notification("paper_uploads"),i.__super__.initialize.call(this,{mainText:"Confirm full-text attachment",confirmButtonText:"CONFIRM",cancelButtonText:"REMOVE",confirmButtonClasses:"btn-success",subText:"Is this the text of your paper, "+t.title+"?"}),this.once("confirm",function(t){return function(){return t.notifyEvent("fulltext_confirmed")}}(this)),this.once("cancel",function(t){return function(){return t.removeAttachment(),t.notifyEvent("fulltext_removed")}}(this)),this.notifyEvent("verify_fulltext_shown")},i.prototype.notifyEvent=function(t){return this.notifier.notify({event:t,user_id:c.User.current.id,work_id:this.workId,attachment_id:this.attachmentId})},i.prototype.removeAttachment=function(){var t;return t=$r.api_v0_attachment_path({id:this.attachmentId,subdomain_param:"api"}),$.post(t,{_method:"DELETE"},function(t){return function(){return window.location="/"+t.workId}}(this))},i}(ConfirmModal)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.InactiveUserFacebookConnectModal=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.events={"click .js-fb-button":"authorizeFacebook"},i.prototype.template=function(){return"single_work/templates/facebook_connect_with_dismiss"},i.prototype.initialize=function(t){return this.title=t.title,Facebook.get_login_status(function(t){return function(e){return"not_authorized"===e.status||"unknown"===e.status?t.render():void 0}}(this))},i.prototype.render=function(){var t,e,i,n,s;return t=this.getBucket(),s=t.split(":")[0],i=t.split(":")[1],n="View Paper","login_to_view_paper"===s&&(n="Log in to View Paper"),e="Continue with Facebook","login_with_facebook"===i&&(e="Log in with Facebook"),this.$el.append(JST[this.template()]({title:this.title,headerText:n,buttonText:e})),this.postRender(),this.ui.modal.modal("show"),this},i.prototype.getBucket=function(){return Academia.Split.startAndRecord("swp_fb_modal_test","login_to_view_paper:login_with_facebook","login_to_view_paper:continue_with_facebook","view_paper:login_with_facebook","view_paper:continue_with_facebook")},i.prototype.postRender=function(){return this.ui={modal:this.$(".js-inactive-user-facebook-connect")}},i.prototype.authorizeFacebook=function(){return Academia.Split.recordSplit("swp_fb_modal_test",!0),Facebook.authorize().done(function(t){return function(e){return Facebook.register_connected(e).done(function(){return t.ui.modal.modal("hide")})}}(this))},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SingleWork.SplashSingleStepSignupForm=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="single_work/templates/splash_single_step_signup_form",i.prototype.events={"submit .js-swp-splash-single-step-signup-form":"submitSignup","keydown .js-swp-splash-single-step-signup-first-name":"logTyping","keydown .js-swp-splash-single-step-signup-email":"logTyping","keydown .js-swp-splash-single-step-signup-last-name":"logTyping","keydown .js-swp-splash-single-step-signup-password":"logTyping","focus .js-swp-splash-single-step-signup-email":"expandEmailForm"},i.prototype.initialize=function(t){return this.log={user_email:!1,user_first_name:!1,user_last_name:!1,user_password:!1},this.notifier=new c.Server.Notification("sutd"),this.render({attachment_type:t.attachment_type,show_oauth_buttons:t.show_oauth_buttons||!1})},i.prototype.render=function(t){return this.$el.html(JST[this.template](t)),this.postRender()},i.prototype.postRender=function(){return this.ui={$first_name:this.$(".js-swp-splash-single-step-signup-first-name"),$last_name:this.$(".js-swp-splash-single-step-signup-last-name"),$password:this.$(".js-swp-splash-single-step-signup-password"),$email:this.$(".js-swp-splash-single-step-signup-email"),$emailForm:this.$(".js-swp-splash-signup-email-form-collapsed"),$googleButton:this.$(".js-swp-splash-single-step-signup-google-button"),$facebookButton:this.$(".js-swp-splash-single-step-signup-facebook-button")},new Academia.Auth.OauthButton.Connect.Facebook({el:this.ui.$facebookButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id"),splash:!0}}),new Academia.Auth.OauthButton.Connect.Google({el:this.ui.$googleButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id"),splash:!0}})},i.prototype.expandEmailForm=function(){return this.ui.$emailForm.collapse("show")},i.prototype.saveFields=function(){return this.model.set({email:this.ui.$email.val()}),this.model.set({first_name:this.ui.$first_name.val()}),this.model.set({last_name:this.ui.$last_name.val()}),this.model.set({password:this.ui.$password.val()}),this.model.set({splash:!0})},i.prototype.renderErrorHTML=function(t){return"<div class='js-swp-splash-input-inner-error swp-splash-input-inner-error u-tcRed a-fadeInDownShort'>"+t+"</div>"},i.prototype.displayErrors=function(t){var e;return e=$(this.ui.$first_name).add(this.ui.$last_name).add(this.ui.$password).add(this.ui.$email),e.removeClass("TextInput--error").css({"padding-top":0}),this.$(".js-swp-splash-input-inner-error").remove(),_.each(t,function(t){return function(e){var i,n;return n=e[0],i=e[1],"user[email]"===n&&t.showErrorForInput(t.ui.$email,i),"user[first_name]"===n&&t.showErrorForInput(t.ui.$first_name,i),"user[last_name]"===n&&t.showErrorForInput(t.ui.$last_name,i),"user[password]"===n?t.showErrorForInput(t.ui.$password,i):void 0}}(this))},i.prototype.showErrorForInput=function(t,e){return t.addClass("TextInput--error").after(this.renderErrorHTML(e.replace(/\.$/g,""))).css({"padding-top":10})},i.prototype.submitSignup=function(t){return t.preventDefault(),this.saveFields(),this.model.save().done(function(t){return function(e){var i,n,s;return s=e[0],i=e[1],n=e[2],s?window.location.replace(i.redirect):(t.notify("validation_failure",{error:JSON.stringify(n)}),t.displayErrors(n))}}(this)).fail(function(){return alert("Something went wrong")})},i.prototype.notify=function(t,e){return null==e&&(e={}),this.notifier.notify({event_type:t,attachment_id:this.model.get("attachment_id"),auvid:$auvid,location:null!=e.location?e.location:void 0,error:null!=e.error?e.error:void 0})},i.prototype.logTyping=function(t){return this.log[t.target.id]||this.notify("started_typing",{location:t.target.id}),this.log[t.target.id]=!0},i}(Backbone.View)}.call(this),function(){Aedu.SignupToDownload||(Aedu.SignupToDownload={}),Aedu.SignupToDownload.notifier=new c.Server.Notification("sutd"),Aedu.SignupToDownload.notifier.notifyAndLog=function(t,e){return null==e&&(e={}),$a.log(t),this.notify({event_type:t,attachment_id:e.attachment_id?e.attachment_id:void 0,auvid:$auvid,location:e.location?e.location:void 0,error:e.error?e.error:void 0})}}.call(this),function(){this.JST||(this.JST={}),this.JST["signup_to_download/templates/layout"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o,r,a){i.push('<div class="DesignSystem"><div style="width:460px" class="modal-dialog"><div class="modal-content u-overflowHidden"><div class="modal-header container-fluid u-p0x"><div class="row u-pv6x"><div class="col-xs-8 col-xs-offset-2"><div class="u-taCenter u-fs14 u-fw700 u-tcGrayDarkest u-textUppercase u-letterSpacing1">'+jade.escape(null==(e=a)?"":e)+"</div></div>"),r&&i.push('<div class="col-xs-2"><button data-dismiss="modal" class="js-close-full-modal u-floatRight Close u-fw400 u-fs20 u-mr4x">&times;</button></div>'),i.push('</div></div><div class="modal-body container-fluid u-p10x"><div class="row u-mb10x"><div class="col-xs-12"><div class="u-taCenter"><div class="u-tcGrayDarkest u-lineHeight1_4 u-fontSerif u-fs22">'+jade.escape(null==(e=o)?"":e)+'</div></div></div></div><div class="row u-mb5x"><div class="col-xs-6 u-pr2x"><button id="google-signup-button" class="Button Button--google Button--block Button--lg"><i class="fa fa-google-plus fa-lg"></i>&nbsp;&nbsp;Connect</button></div><div class="col-xs-6 u-pl2x"><button id="fb-signup-button" class="Button Button--facebook Button--block Button--lg"><i class="fa fa-facebook-square fa-lg"></i>&nbsp;&nbsp;Connect</button></div></div><div class="row u-mb5x"><div class="col-xs-12"><div class="hr-heading login-hr-heading"><span class="hr-heading-text">or</span></div></div></div><form class="js-modal-title-form container-fluid"><div class="row u-mb5x"><div class="col-xs-12 u-ph0x TextInputWrapper--icon u-floatLeft"><input placeholder="Email" type="email" id="user_email" class="TextInput TextInput--xl js-modal-title-email swp-splash-single-step-singup-input"/><i class="fa fa-envelope-o u-tcGrayDark js-modal-title-envelope"></i></div></div><div class="row"><div class="col-xs-12 collapse js-modal-title-form-collapsed"><div class="row u-mb5x"><div class="col-xs-6 u-pl0x u-pr2x"><input placeholder="First Name" id="user_first_name" class="TextInput TextInput--xl js-modal-title-first-name swp-splash-single-step-singup-input"/></div><div class="col-xs-6 u-pl2x u-pr0x"><div class="u-positionRelative"><input placeholder="Last Name" id="user_last_name" class="TextInput TextInput--xl js-modal-title-last-name swp-splash-single-step-singup-input"/></div></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><input type="password" placeholder="Password" id="user_password" class="TextInput TextInput--xl js-modal-title-password swp-splash-single-step-singup-input"/></div></div><div class="row u-mb5x"><div class="col-xs-12 u-ph0x"><button type="submit" class="js-modal-signup-submit swp-splash-signup-submit Button Button--block Button--lg Button--green">'),i.push(n?jade.escape(null==(e=n)?"":e):"<i"+jade.cls(["fa","fa-lg","pdf"===t?"fa-file-pdf-o":"fa-file-text-o"],[null,null,!0])+"></i>&nbsp;&nbsp;\nGET "+jade.escape(null==(e="pdf"===t?"PDF":"FILE")?"":e)),i.push('</button></div></div></div></div><div class="row"><div class="col-xs-12 u-ph0x u-taCenter"><div class="u-fw400 u-fs12 u-tcGrayDark">Already have an account?\n&nbsp;<a'+jade.attr("href",s,!0,!1)+' class="u-linkUnstyled u-textDecorationUnderline u-tcBlue">Log in</a></div></div></div></form></div></div></div></div>')}.call(this,"attachmentType"in n?n.attachmentType:"undefined"!=typeof attachmentType?attachmentType:void 0,"buttonText"in n?n.buttonText:"undefined"!=typeof buttonText?buttonText:void 0,"loginUrl"in n?n.loginUrl:"undefined"!=typeof loginUrl?loginUrl:void 0,"message"in n?n.message:"undefined"!=typeof message?message:void 0,"showCloseButton"in n?n.showCloseButton:"undefined"!=typeof showCloseButton?showCloseButton:void 0,"title"in n?n.title:"undefined"!=typeof title?title:void 0),i.join("")}}.call(this),function(){Aedu.SignupToDownload.Layout=Backbone.View.extend({template:"signup_to_download/templates/layout",className:"modal fade",events:{"focus .js-modal-title-email":"expandEmailForm","click .js-modal-signup-submit":"submitSignup","click .js-modal-terms-link":"termsClicked","keydown .js-modal-title-first-name":"logTyping","keydown .js-modal-title-last-name":"logTyping","keydown .js-modal-title-password":"logTyping","keydown .js-modal-title-email":"logTyping"},initialize:function(t){return null==t&&(t={}),this.model=new MobileRegPath.newUser({attachment_id:t.attachmentId,login_redirect:t.loginRedirect,user_source:t.userSource}),this.data={loginUrl:t.loginUrl||"/login",message:t.message,attachmentType:null!=t.attachmentType?t.attachmentType:void 0,title:t.title,buttonText:t.buttonText,showCloseButton:t.showCloseButton},this.log={user_email:!1,user_first_name:!1,user_last_name:!1,user_password:!1},this.render(this.data)},render:function(t){return this.$el.html(JST[this.template](t)),this.postRender()},postRender:function(){return this.ui={$emailForm:this.$(".js-modal-title-form-collapsed"),$googleButton:this.$("#google-signup-button"),$facebookButton:this.$("#fb-signup-button"),$firstName:this.$(".js-modal-title-first-name"),$lastName:this.$(".js-modal-title-last-name"),$password:this.$(".js-modal-title-password"),$email:this.$(".js-modal-title-email"),$envelope:this.$(".js-modal-title-envelope")},new Academia.Auth.OauthButton.Connect.Facebook({el:this.ui.$facebookButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id")}}),new Academia.Auth.OauthButton.Connect.Google({el:this.ui.$googleButton,track:!0,registrationParams:{doc_id:this.model.get("attachment_id")}}),this.$el.modal({backdrop:"static",keyboard:!1}),this.$el.on("hidden.bs.modal",function(){return Aedu.SignupToDownload.notifier.notifyAndLog("download_closed")})},expandEmailForm:function(){return this.ui.$emailForm.collapse("show")},submitSignup:function(t){return t.preventDefault(),Aedu.SignupToDownload.notifier.notifyAndLog("attempted_submit"),this.saveFields(),this.model.savingToServer?void 0:this.model.save().done(function(t){return function(e){var i,n,s;return s=e[0],i=e[1],n=e[2],s?t.redirectToPage(i.redirect):(Aedu.SignupToDownload.notifier.notifyAndLog("validation_failure",{error:JSON.stringify(n)}),t.displayErrors(n))}}(this)).fail(function(){return alert("Something went wrong")})},saveFields:function(){return this.model.set({email:this.ui.$email.val(),first_name:this.ui.$firstName.val(),last_name:this.ui.$lastName.val(),password:this.ui.$password.val()})},renderErrorHTML:function(t){return"<div class='js-swp-splash-input-inner-error swp-splash-input-inner-error u-tcRed a-fadeInDownShort'>"+t+"</div>"},displayErrors:function(t){var e;return e=$(this.ui.$firstName).add(this.ui.$lastName).add(this.ui.$password).add(this.ui.$email),e.removeClass("TextInput--error").css({"padding-top":0}),this.ui.$envelope.css({"padding-top":0}),this.$(".js-swp-splash-input-inner-error").remove(),_.each(t,function(t){return function(e){var i,n;
return n=e[0],i=e[1],"user[email]"===n&&t.showErrorForEmail(t.ui.$email,i),"user[first_name]"===n&&t.showErrorForInput(t.ui.$firstName,i),"user[last_name]"===n&&t.showErrorForInput(t.ui.$lastName,i),"user[password]"===n?t.showErrorForInput(t.ui.$password,i):void 0}}(this))},showErrorForInput:function(t,e){return t.addClass("TextInput--error").after(this.renderErrorHTML(e.replace(/\.$/g,""))).css({"padding-top":10})},showErrorForEmail:function(t,e){return t.addClass("TextInput--error").css({"padding-top":10}),this.ui.$envelope.after(this.renderErrorHTML(e.replace(/\.$/g,""))).css({"padding-top":5})},termsClicked:function(){return Aedu.SignupToDownload.notifier.notifyAndLog("terms",{auvid:$auvid})},logTyping:function(t){return this.log[t.target.id]?void 0:(Aedu.SignupToDownload.notifier.notifyAndLog("started_typing",{location:t.target.id}),this.log[t.target.id]=!0)},redirectToPage:function(t){return window.location.replace(t)}})}.call(this),function(){this.SidebarSuggestions||(this.SidebarSuggestions={})}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestionsCollection=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.on("sync",function(){return this.displayable().length<=0?this.trigger("empty"):void 0}),this},i.prototype.ensureMinDisplayable=function(t){return this.displayable().length<t&&!this._fetching&&(this._fetching=!0,this.fetch().always(function(t){return function(){return t._fetching=!1}}(this))),this.once("remove",function(){return this.ensureMinDisplayable(t)})},i}(Backbone.Collection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedCertification=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.set("id",t.work.id),i.__super__.initialize.apply(this,arguments)},i.prototype.url=function(){return $r.api_v0_suggestions_certification_path({id:this.id,subdomain_param:"api"})},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedCertifications=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedCertification,i.prototype.url=$r.api_v0_suggestions_certifications_path({subdomain_param:"api"}),i.prototype.displayable=function(t){return this.slice(this.length-t,this.length)},i.prototype.parse=function(t){return null!=t?t.certifications:void 0},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedCoauthor=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.saveSuggestion=function(t){var e;return e=$.extend(this.get("tags")[0],{accepted:t,source:"coauthor_suggestions_sidebar"}),$.ajax({url:$r.api_v0_suggestions_coauthors_path({subdomain_param:"api"}),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e)})},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedDiscussion=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedDiscussions=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedDiscussion,i.prototype.url=$r.api_v0_suggestions_discussions_path({subdomain_param:"api",count:5}),i.prototype.parse=function(t){return null!=t?t.discussions:void 0},i.prototype.displayable=function(t){return this.slice(this.length-t,this.length)},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedHistory=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.set("id",t.work.id),i.__super__.initialize.apply(this,arguments)},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedHistorys=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedHistory,i.prototype.url=$r.api_v0_suggestions_histories_path({subdomain_param:"api"}),i.prototype.displayable=function(){return this.slice(0,this.length>3?3:this.length)},i.prototype.parse=function(t){return null!=t?t.histories:void 0},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedInterest=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.set("id",t.interest.id),i.__super__.initialize.apply(this,arguments)},i.prototype.url=function(){return $r.api_v0_suggestions_interest_path({id:this.get("interest").id,subdomain_param:"api",s:this.sourceString()})},i.prototype.sourceString=function(){return this.get("sources").sort().join(",")},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedInterests=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedInterest,i.prototype.url=$r.api_v0_suggestions_interests_path({subdomain_param:"api",count:12}),i.prototype.parse=function(t){return null!=t?t.interests:void 0},i.prototype.displayable=function(t){return this.filter(function(t){return!c.User.current.has_interest(t.get("interest").id)}).slice(0,t)},i.prototype.removeById=function(t){var e;return e=this.findWhere({id:t}),this.remove(e),e},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedJob=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments)},i.prototype.url=function(){return $r.randomized_last_api_v0_suggestions_jobs_path({subdomain_param:"api"})},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedUser=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return this.set("id",t.user.id),i.__super__.initialize.apply(this,arguments)},i.prototype.url=function(){return $r.api_v0_suggestions_following_path({id:this.get("user").id,subdomain_param:"api",s:this.sourceString()})},i.prototype.sourceString=function(){return this.get("sources").sort().join(",")},i.prototype.followData=function(){return{"data-follow-user-id":this.get("user").id,"data-follow-user-source":"sidebar_suggestion","data-follow-user-src-details":{sources:this.sourceString()},"data-follow-user-fname":this.get("user").first_name}},i.prototype.reason=function(t){var e,i,n,s,o;return null==t&&(t=!0),o=this.get("user"),s=_(this.get("sources")),n=t?this._linkedName(o,o.first_name):o.first_name,s.include("AuthorsBookmarked")?"You have bookmarked "+n+"'s research.":s.include("FollowedByFollowees")&&(e=this._connectingUserLinks(t)).length>0?n+" is followed by "+$h.to_sentence(e.slice(0,3))+".":s.include("DepartmentColleagues")&&this.departmentName()&&this.universityName()?n+" is a colleague in "+this.departmentName()+" at "+this.universityName():s.include("FollowedBySimilarFollowers")?n+" is followed by people who follow the same other researchers as you.":s.include("FollowedBySimilarBookmarkers")?n+" is followed by researchers who have bookmarked the same works as you.":s.include("TopResearchInterestUsers")&&(i=this._commonInterestNames()).length>0?n+" is among the top researchers in "+$h.to_sentence(i.slice(0,3))+" on Academia.edu.":c.User.current.followee_ids.length>0?n+" is similar to other researchers you follow.":n+" is someone you might know."},i.prototype.universityName=function(){var t,e;return null!=(t=this.get("user").department)&&null!=(e=t.university)?e.name:void 0},i.prototype.departmentName=function(){var t;return null!=(t=this.get("user").department)?t.name:void 0},i.prototype._commonInterestNames=function(){var t,e,i,n,s,o;if(o=this.get("user"),o.interests&&c.User.current.interests){for(n=o.interests,s=[],e=0,i=n.length;i>e;e++)t=n[e],c.User.current.has_interest(t.id)&&s.push(t.name);return s}return[]},i.prototype._connectingUserLinks=function(t){var e,i;return null==t&&(t=!0),e=this.get("connecting_users"),e&&t?_.shuffle(function(){var t,n,s;for(s=[],t=0,n=e.length;n>t;t++)i=e[t],s.push(this._linkedName(i,i.display_name));return s}.call(this)):e?_.shuffle(function(){var t,n,s;for(s=[],t=0,n=e.length;n>t;t++)i=e[t],s.push(i.display_name);return s}()):[]},i.prototype._linkedName=function(t,e){return $("<a/>").attr("href",t.url).addClass("u-tcGray u-textDecorationUnderline").text(e)[0].outerHTML},i}(Backbone.Model)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedUsers=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedUser,i.prototype.initialize=function(t,e){return null==e&&(e=10),this.url=$r.api_v0_suggestions_following_index_path({subdomain_param:"api",count:e}),i.__super__.initialize.apply(this,arguments)},i.prototype.parse=function(t){return null==(null!=t?t.following:void 0)?[]:_(t.following).map(function(t){var e;return new SidebarSuggestions.SuggestedUser({sources:t.sources,user:c.User.from_json(t.user),connecting_users:function(){var i,n,s,o;for(s=t.connecting_users||[],o=[],i=0,n=s.length;n>i;i++)e=s[i],o.push(c.User.from_json(e));return o}()})})},i.prototype.displayable=function(t){return this.filter(function(t){return!c.User.current.follows(t.get("user").id)}).slice(0,t)},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.TrendingWork=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.url=function(){return $r.trending_api_v0_suggestions_works_path({subdomain_param:"api"})},i}(Backbone.Model)}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_affiliation"]=function(t){var e,i=[],n=t||{};return function(t){i.push('<div class="Panel u-mb5x"><div class="Panel-header u-p5x"><div class="js-sidebar-add-affiliation-university u-taCenter u-fw700 u-tcGrayDark">'+jade.escape(null==(e=t)?"":e)+'</div></div><div class="Panel-bodySegment u-p5x u-taCenter"><div class="newsfeed-sidebar-oauth-actions-new"><a class="Button js-news-sidebar-add-affiliation">&nbsp;&nbsp;Edit Affiliation</a></div></div></div><div class="DesignSystem"><div class="modal js-news-add-affiliation-modal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><div class="modal-title"></div><div class="modal-body"><div class="js-newsfeed-add-affiliation-modal-body"></div></div></div></div></div></div></div>')}.call(this,"guessText"in n?n.guessText:"undefined"!=typeof guessText?guessText:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_certifications"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o){i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var n=o;if("number"==typeof n.length)for(var r=0,a=n.length;a>r;r++){var u=n[r],l=u.get("work");i.push("<li"+jade.attr("id","certify_work_"+l.id,!0,!1)+' class="Panel-bodySegment u-p5x"><a'+jade.attr("href",l.internal_url,!0,!1)+" data-sidebar-truncate-to-lines='3' class=\"js-sidebar-truncate u-fw700 u-tcGrayDarker\">"+jade.escape(null==(e=l.title)?"":e)+'</a><div class="u-p1x"></div><div class="u-textTruncate u-tcGray"><a'+jade.attr("data-work-title",l.title,!0,!1)+jade.attr("data-work-id",l.id,!0,!1)+jade.attr("data-field-follower-count",u.get("potential_reach"),!0,!1)+' disabled="disabled" class="js-certification-button u-tcGreen u-fw700 u-clickable"><i class="fa fa-check">&nbsp;&nbsp;</i>Recommend</a><span>&nbsp; | &nbsp;</span><a'+jade.attr("href",l.authors[0].url,!0,!1)+jade.attr("data-has-card-for-user",l.authors[0].id,!0,!1)+' class="u-tcGray">'+jade.escape(null==(e=l.authors[0].display_name)?"":e)+"</a><script"+jade.attr("data-card-contents-for-user",l.authors[0].id,!0,!1)+' type="text/json">'+(null==(e=t.encodeHTML(s.stringify(l.authors[0])))?"":e)+"</script></div></li>")}else{var a=0;for(var r in n){a++;var u=n[r],l=u.get("work");i.push("<li"+jade.attr("id","certify_work_"+l.id,!0,!1)+' class="Panel-bodySegment u-p5x"><a'+jade.attr("href",l.internal_url,!0,!1)+" data-sidebar-truncate-to-lines='3' class=\"js-sidebar-truncate u-fw700 u-tcGrayDarker\">"+jade.escape(null==(e=l.title)?"":e)+'</a><div class="u-p1x"></div><div class="u-textTruncate u-tcGray"><a'+jade.attr("data-work-title",l.title,!0,!1)+jade.attr("data-work-id",l.id,!0,!1)+jade.attr("data-field-follower-count",u.get("potential_reach"),!0,!1)+' disabled="disabled" class="js-certification-button u-tcGreen u-fw700 u-clickable"><i class="fa fa-check">&nbsp;&nbsp;</i>Recommend</a><span>&nbsp; | &nbsp;</span><a'+jade.attr("href",l.authors[0].url,!0,!1)+jade.attr("data-has-card-for-user",l.authors[0].id,!0,!1)+' class="u-tcGray">'+jade.escape(null==(e=l.authors[0].display_name)?"":e)+"</a><script"+jade.attr("data-card-contents-for-user",l.authors[0].id,!0,!1)+' type="text/json">'+(null==(e=t.encodeHTML(s.stringify(l.authors[0])))?"":e)+"</script></div></li>")}}}.call(this),i.push("<li><a"+jade.attr("href",n.certifications_suggestions_path(),!0,!1)+" class=\"u-tcGrayDark\"><div class=\"Panel-footer u-p5x u-taCenter\"><span class=\"u-fw700\">View All</span></div></a></li></ul><script src=\"//cdn.rawgit.com/inorganik/countUp.js/v1.3.3/countUp.min.js\"></script><script type=\"text/javascript\">(function() {\n  req_and_ready('certifications');\n  $('.js-certification-button').on('click', showCertifyModal);\n  function showCertifyModal(evt) {\n    var $button = $(this),\n      workId = parseInt($button.data('work-id')),\n      params = {\n        workTitle: $button.data('work-title'),\n        workId: workId,\n        fieldFollowerCount: parseInt($button.data('field-follower-count')),\n        source: 'newsfeed_sidebar',\n        // If this page was in Flux, this would come from a Flux event, but\n        // that's not feasible right now.\n        onCertify: function() {$('#certify_work_' + workId).fadeOut('slow')}\n      };\n    Components.Utils.showModal(Certifications.Modals.CertificationModal, params)\n  }\n})();</script>")}.call(this,"$h"in n?n.$h:"undefined"!=typeof $h?$h:void 0,"$r"in n?n.$r:"undefined"!=typeof $r?$r:void 0,"JSON"in n?n.JSON:"undefined"!=typeof JSON?JSON:void 0,"suggestions"in n?n.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in n?n.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_coauthor"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o){i.push('<div class="Media"><div class="Media--left Media--middle">'),s=t.get("profile_picture_url"),o=t.get("affiliated_university"),i.push("undefined"!=typeof s&&null!==s&&o?"<img"+jade.attr("src",s,!0,!1)+' class="avatar-md"/>':'<div class="avatar-md bg-gray-lighter u-taCenter valign-wrapper"><i class="fa fa-inverse fa-envelope-o fa-sm valign-item"></i></div>'),i.push('</div><div class="Media-body"><div style="width:200px" class="u-tcGrayDarker u-fw700 u-textTruncate">'+jade.escape(null==(e=t.get("name"))?"":e)+'</div><div style="width:200px" class="u-tcGrayDark u-pt1x u-textTruncate"><i class="fa fa-file-o"> </i>&nbsp;&nbsp;'+jade.escape(null==(e=t.get("tags")[0].title)?"":e)+'</div></div></div><div class="js-expanded-content hidden"><div class="Media"><div class="Media--left Media--middle"><div class="avatar-md"></div></div><div class="Media-body u-mv2x u-tcGrayDark u-pt1x">'),"undefined"!=typeof o&&null!==o?i.push('<i class="fa fa-university"></i>&nbsp;&nbsp;'+jade.escape(null==(e=o)?"":e)):(i.push('<i class="fa fa-envelope-o"> </i>&nbsp;&nbsp;'),n=t.get("obfuscated_email"),i.push("undefined"!=typeof n&&null!==n?jade.escape(null==(e=n)?"":e):'<input class="js-coauthor-email"/>')),i.push('</div></div><div class="row u-m0x"><div class="col-xs-6 u-pr2x u-pl0x u-taCenter"><a class="js-coauthor-reject-coauthor Button Button--block Button--sm Button--inverseGray"><i class="fa fa-times"></i>&nbsp;&nbsp;Dismiss</a></div><div class="col-xs-6 u-pl2x u-pr0x u-taCenter"><a class="js-coauthor-accept-coauthor Button Button--block Button--sm Button--blue u-pl4x"><i class="fa fa-plus"></i>&nbsp;&nbsp;Confirm</a></div></div></div>')}.call(this,"coauthor"in n?n.coauthor:"undefined"!=typeof coauthor?coauthor:void 0,"email"in n?n.email:"undefined"!=typeof email?email:void 0,"photo"in n?n.photo:"undefined"!=typeof photo?photo:void 0,"university_name"in n?n.university_name:"undefined"!=typeof university_name?university_name:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_coauthors"]=function(){var t=[];return t.push('<ul class="u-listStyleNone u-pl0x u-mb0x"></ul>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_discussion"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o){var r=o.chair,a=t.build_url(o.url,[["source","sidebar"]]);i.push("<a"+jade.attr("href",a,!0,!1)+' class="text-bold u-tcGrayDarker js-suggested-discussion-name">'+jade.escape(null==(e=o.name)?"":e)+'</a><div class="discussion-suggestion-info u-mt1x"><a'+jade.attr("href",a,!0,!1)+' class="text-bold">Join</a><span class="u-tcGray"><span>&nbsp; | &nbsp;</span><a'+jade.attr("href",a,!0,!1)+' class="u-tcGray"><i class="fa fa-comment u-pr2x"></i>'+jade.escape(null==(e=o.comment_count)?"":e)+"</a><span>&nbsp; | &nbsp;</span><a"+jade.attr("href",r.url,!0,!1)+jade.attr("data-has-card-for-user",r.id,!0,!1)+' class="u-tcGray">'+jade.escape(null==(e=r.display_name)?"":e)+"<script"+jade.attr("data-card-contents-for-user",r.id,!0,!1)+' type="text/json">'+(null==(e=n.encodeHTML(s.stringify(r)))?"":e)+"</script></a></span></div>")}.call(this,"$a"in n?n.$a:"undefined"!=typeof $a?$a:void 0,"$h"in n?n.$h:"undefined"!=typeof $h?$h:void 0,"JSON"in n?n.JSON:"undefined"!=typeof JSON?JSON:void 0,"suggestion"in n?n.suggestion:"undefined"!=typeof suggestion?suggestion:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_discussions"]=function(){var t=[];return t.push('<!-- Required by SuggestionListView. TODO: Refactor suggestions code so--><!-- this template isn\'t needed.--><ul class="list-unstyled margin-bottom-0x"></ul>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_history"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o){i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var r=o;if("number"==typeof r.length)for(var a=0,u=r.length;u>a;a++){var l=r[a],c=l.get("work"),d=c.authors[0];if(i.push('<li class="Panel-bodySegment u-p5x"><a'+jade.attr("href",c.internal_url,!0,!1)+" data-sidebar-truncate-to-lines='2' class=\"js-sidebar-truncate u-fw700 u-tcGrayDarker\">"+jade.escape(null==(e=c.title)?"":e)+"</a><div><a"+jade.attr("href",d.url,!0,!1)+jade.attr("data-has-card-for-user",d.id,!0,!1)+' class="u-tcGrayDark u-displayInline">'+jade.escape(null==(e=d.display_name)?"":e)+"</a><script"+jade.attr("data-card-contents-for-user",d.id,!0,!1)+' type="text/json">'+(null==(e=t.encodeHTML(n.stringify(d)))?"":e)+'</script><div class="u-tcGrayLight js-sidebar-truncate u-displayInline">'),"undefined"!=typeof d.department&&"undefined"!=typeof d.department.university)i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=d.department.university.name)?"":e));else if("undefined"!=typeof d.interests&&d.interests.length>0){var p=s(d.interests.slice(0,3)).map(function(t){return t.name});i.push("$nbsp; | &nbsp;"+jade.escape(null==(e=t.to_sentence(p))?"":e))}else i.push("&nbsp; | &nbsp; Independent Researcher");i.push("</div></div></li>")}else{var u=0;for(var a in r){u++;var l=r[a],c=l.get("work"),d=c.authors[0];if(i.push('<li class="Panel-bodySegment u-p5x"><a'+jade.attr("href",c.internal_url,!0,!1)+" data-sidebar-truncate-to-lines='2' class=\"js-sidebar-truncate u-fw700 u-tcGrayDarker\">"+jade.escape(null==(e=c.title)?"":e)+"</a><div><a"+jade.attr("href",d.url,!0,!1)+jade.attr("data-has-card-for-user",d.id,!0,!1)+' class="u-tcGrayDark u-displayInline">'+jade.escape(null==(e=d.display_name)?"":e)+"</a><script"+jade.attr("data-card-contents-for-user",d.id,!0,!1)+' type="text/json">'+(null==(e=t.encodeHTML(n.stringify(d)))?"":e)+'</script><div class="u-tcGrayLight js-sidebar-truncate u-displayInline">'),"undefined"!=typeof d.department&&"undefined"!=typeof d.department.university)i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=d.department.university.name)?"":e));else if("undefined"!=typeof d.interests&&d.interests.length>0){var p=s(d.interests.slice(0,3)).map(function(t){return t.name});i.push("$nbsp; | &nbsp;"+jade.escape(null==(e=t.to_sentence(p))?"":e))}else i.push("&nbsp; | &nbsp; Independent Researcher");i.push("</div></div></li>")}}}.call(this),i.push('<li><a href="/ReadingHistory" class="u-tcGrayDark"><div class="Panel-footer u-p5x u-taCenter"><span class="u-fw700">View All</span></div></a></li></ul>')}.call(this,"$h"in n?n.$h:"undefined"!=typeof $h?$h:void 0,"JSON"in n?n.JSON:"undefined"!=typeof JSON?JSON:void 0,"_"in n?n._:"undefined"!=typeof _?_:void 0,"suggestions"in n?n.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in n?n.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_interests"]=function(t){var e,i=[],n=t||{};return function(t,n){i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var s=n;if("number"==typeof s.length)for(var o=0,r=s.length;r>o;o++){var a=s[o],u=a.get("interest");i.push("<li"+jade.attr("id","ri_suggestion_"+a.get("id"),!0,!1)+' class="followee-suggestion Panel-bodySegment u-p5x close-container"><div class="Media"><div'+jade.attr("data-ignore-suggested-ri-id",u.id,!0,!1)+' class="pull-right sidebar-close clickable"><a class="u-tcGrayLight u-textDecorationNone sidebar-close">&times;</a></div><div class="Media--middle Media--left"><a'+jade.attr("href",u.url,!0,!1)+' class="u-tcGrayDarker"><span class="u-fw700 js-sidebar-truncate">'+jade.escape(null==(e=u.name)?"":e)+'</span></a><div class="u-mt1x u-fs13"><a'+jade.attr("data-follow-ri-id",u.id,!0,!1)+' class="u-tcGreen u-fw700 clickable">Follow</a><span class="u-tcGray u-textTruncate u-displayInline">&nbsp; | &nbsp;'+jade.escape(null==(e=t.commaizeInt(u.follower_count))?"":e)+"&nbsp;Followers</span></div></div></div></li>")}else{var r=0;for(var o in s){r++;var a=s[o],u=a.get("interest");i.push("<li"+jade.attr("id","ri_suggestion_"+a.get("id"),!0,!1)+' class="followee-suggestion Panel-bodySegment u-p5x close-container"><div class="Media"><div'+jade.attr("data-ignore-suggested-ri-id",u.id,!0,!1)+' class="pull-right sidebar-close clickable"><a class="u-tcGrayLight u-textDecorationNone sidebar-close">&times;</a></div><div class="Media--middle Media--left"><a'+jade.attr("href",u.url,!0,!1)+' class="u-tcGrayDarker"><span class="u-fw700 js-sidebar-truncate">'+jade.escape(null==(e=u.name)?"":e)+'</span></a><div class="u-mt1x u-fs13"><a'+jade.attr("data-follow-ri-id",u.id,!0,!1)+' class="u-tcGreen u-fw700 clickable">Follow</a><span class="u-tcGray u-textTruncate u-displayInline">&nbsp; | &nbsp;'+jade.escape(null==(e=t.commaizeInt(u.follower_count))?"":e)+"&nbsp;Followers</span></div></div></div></li>")}}}.call(this),i.push("</ul>")}.call(this,"$h"in n?n.$h:"undefined"!=typeof $h?$h:void 0,"suggestions"in n?n.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in n?n.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_jobs"]=function(t){var e,i=[],n={},s=t||{};return function(t){n.media=function(t){this&&this.block,this&&this.attributes||{};i.push('<div class="media_v2 u-mt0x"><div class="media-body media-middle"><a data-broccoli-component="job-title"'+jade.attr("href",t.url,!0,!1)+' style="width:190px" class="u-tcBlue u-fw700">'+jade.escape(null==(e=t.title)?"":e)+"</a></div></div>")},i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var s=t;if("number"==typeof s.length)for(var o=0,r=s.length;r>o;o++){var a=s[o],u=a.get("job");i.push("<li"+jade.attr("id","job_"+u.id,!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(u),i.push(u.universities.length>0?'<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'+jade.escape(null==(e=u.universities[0].name)?"":e)+"</div>":'<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'+jade.escape(null==(e=u.location)?"":e)+"</div>"),i.push("</li>")}else{var r=0;for(var o in s){r++;var a=s[o],u=a.get("job");i.push("<li"+jade.attr("id","job_"+u.id,!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(u),i.push(u.universities.length>0?'<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'+jade.escape(null==(e=u.universities[0].name)?"":e)+"</div>":'<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'+jade.escape(null==(e=u.location)?"":e)+"</div>"),i.push("</li>")}}}.call(this),i.push("</ul>")}.call(this,"suggestions"in s?s.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in s?s.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_users"]=function(t){var e,i=[],n=t||{};return function(t,n,s,o){i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var r=o;if("number"==typeof r.length)for(var a=0,u=r.length;u>a;a++){var l=r[a],c=l.get("user");if(i.push("<li"+jade.attr("id","user_suggestion_"+l.get("id"),!0,!1)+' class="followee-suggestion Panel-bodySegment u-p5x close-container"><div'+jade.attr("data-ignore-suggested-user-id",c.id,!0,!1)+' data-broccoli-component="sidebar-user-ignore" class="u-floatRight sidebar-close u-clickable"><a class="u-tcGrayLight u-textDecorationNone sidebar-close">&times;</a></div><div class="Media u-mt0x"><div class="Media--left Media--middle u-pr3x"><img'+jade.attr("src",c.photo,!0,!1)+' class="Avatar Avatar--sm"/></div><div class="Media-body"><a'+jade.attr("href",c.url,!0,!1)+' style="width:190px" class="u-tcGrayDarker u-fw700 u-textTruncate">'+jade.escape(null==(e=c.display_name)?"":e)+'</a><div class="js-sidebar-truncate u-fs13">'),s=l.followData(),s["data-broccoli-component"]="sidebar-user-follow",i.push("<a"+jade.attrs(jade.merge([{"class":"u-tcGreen u-fw700 u-clickable"},s]),!1)+'>Follow</a><span class="u-tcGray">'),c.is_affiliated()&&c.department)i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=c.department.university.name)?"":e));else if(c.has_research_interests()){var d=n(c.interests.slice(0,3)).map(function(t){return t.name});i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=t.to_sentence(d))?"":e))}else i.push("&nbsp; | &nbsp; Independent Researcher");i.push("</span></div></div></div></li>")}else{var u=0;for(var a in r){u++;var l=r[a],c=l.get("user");if(i.push("<li"+jade.attr("id","user_suggestion_"+l.get("id"),!0,!1)+' class="followee-suggestion Panel-bodySegment u-p5x close-container"><div'+jade.attr("data-ignore-suggested-user-id",c.id,!0,!1)+' data-broccoli-component="sidebar-user-ignore" class="u-floatRight sidebar-close u-clickable"><a class="u-tcGrayLight u-textDecorationNone sidebar-close">&times;</a></div><div class="Media u-mt0x"><div class="Media--left Media--middle u-pr3x"><img'+jade.attr("src",c.photo,!0,!1)+' class="Avatar Avatar--sm"/></div><div class="Media-body"><a'+jade.attr("href",c.url,!0,!1)+' style="width:190px" class="u-tcGrayDarker u-fw700 u-textTruncate">'+jade.escape(null==(e=c.display_name)?"":e)+'</a><div class="js-sidebar-truncate u-fs13">'),s=l.followData(),s["data-broccoli-component"]="sidebar-user-follow",i.push("<a"+jade.attrs(jade.merge([{"class":"u-tcGreen u-fw700 u-clickable"},s]),!1)+'>Follow</a><span class="u-tcGray">'),c.is_affiliated()&&c.department)i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=c.department.university.name)?"":e));else if(c.has_research_interests()){var d=n(c.interests.slice(0,3)).map(function(t){return t.name});i.push("&nbsp; | &nbsp;"+jade.escape(null==(e=t.to_sentence(d))?"":e))}else i.push("&nbsp; | &nbsp; Independent Researcher");i.push("</span></div></div></div></li>")}}}.call(this),i.push("</ul>")}.call(this,"$h"in n?n.$h:"undefined"!=typeof $h?$h:void 0,"_"in n?n._:"undefined"!=typeof _?_:void 0,"followData"in n?n.followData:"undefined"!=typeof followData?followData:void 0,"suggestions"in n?n.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in n?n.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_users_v2"]=function(t){var e,i=[],n={},s=t||{};return function(t,s,o,r){n.media=function(t,n){this&&this.block,this&&this.attributes||{};i.push('<div class="media_v2 u-mt0x"><div class="media-left media-middle u-pr3x"><img'+jade.attr("src",n.photo,!0,!1)+' class="Avatar Avatar--sm"/></div><div class="media-body media-middle"><a'+jade.attr("href",n.url,!0,!1)+' style="width:190px" class="u-tcGrayDarker u-fw700 u-textTruncate">'+jade.escape(null==(e=n.display_name)?"":e)+'</a><ul class="InlineList InlineList--bordered">'),o=t.followData(),o["data-broccoli-component"]="sidebar-user-follow",i.push("<li"+jade.attrs(jade.merge([{"class":"InlineList-item u-tcGreen u-fs13 u-lineHeight0 u-clickable"},o]),!1)+'><i class="fa fa-plus"></i>&nbsp;\nFollow</li><li'+jade.attr("data-ignore-suggested-user-id",n.id,!0,!1)+' data-broccoli-component="sidebar-user-ignore" class="InlineList-item u-tcGrayDark u-fs13 u-lineHeight0 u-clickable"><i class="fa fa-remove"></i>&nbsp;\nIgnore</li></ul></div></div>')},i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var o=r;if("number"==typeof o.length)for(var a=0,u=o.length;u>a;a++){var l=o[a],c=l.get("user");if(i.push("<li"+jade.attr("id","user_suggestion_"+l.get("id"),!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(l,c),i.push('<span class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'),c.is_affiliated()&&c.department)i.push(jade.escape(null==(e=c.department.university.name+", "+c.department.name+", "+c.position)?"":e));
else if(c.has_research_interests()){var d=s(c.interests.slice(0,3)).map(function(t){return t.name});i.push(jade.escape(null==(e=t.to_sentence(d))?"":e))}else i.push("<Independent>Researcher</Independent>");i.push('</span><br/><span class="u-tcGray u-fs11 u-lineHeight1_3 u-displayInlineBlock">'+(null==(e=l.reason())?"":e)+"</span></li>")}else{var u=0;for(var a in o){u++;var l=o[a],c=l.get("user");if(i.push("<li"+jade.attr("id","user_suggestion_"+l.get("id"),!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(l,c),i.push('<span class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">'),c.is_affiliated()&&c.department)i.push(jade.escape(null==(e=c.department.university.name+", "+c.department.name+", "+c.position)?"":e));else if(c.has_research_interests()){var d=s(c.interests.slice(0,3)).map(function(t){return t.name});i.push(jade.escape(null==(e=t.to_sentence(d))?"":e))}else i.push("<Independent>Researcher</Independent>");i.push('</span><br/><span class="u-tcGray u-fs11 u-lineHeight1_3 u-displayInlineBlock">'+(null==(e=l.reason())?"":e)+"</span></li>")}}}.call(this),i.push("</ul>")}.call(this,"$h"in s?s.$h:"undefined"!=typeof $h?$h:void 0,"_"in s?s._:"undefined"!=typeof _?_:void 0,"followData"in s?s.followData:"undefined"!=typeof followData?followData:void 0,"suggestions"in s?s.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in s?s.undefined:void 0),i.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["sidebar_suggestions/templates/suggested_works"]=function(t){var e,i=[],n={},s=t||{};return function(t){n.media=function(t){this&&this.block,this&&this.attributes||{};i.push('<div class="media_v2 u-mt0x"><div class="media-body media-middle"><a'+jade.attr("href",t.internal_url,!0,!1)+' style="width:190px" data-broccoli-component="trending-works" class="u-tcBlue u-fw700">'+jade.escape(null==(e=t.title)?"":e)+"</a></div></div>")},i.push('<ul class="u-listStyleNone u-pl0x u-mb0x">'),function(){var s=t;if("number"==typeof s.length)for(var o=0,r=s.length;r>o;o++){var a=s[o],u=a.get("work");i.push("<li"+jade.attr("id","work_"+u.id,!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(u),i.push('<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">by&nbsp;'+jade.escape(null==(e=u.authors[0].display_name)?"":e)+"</div></li>")}else{var r=0;for(var o in s){r++;var a=s[o],u=a.get("work");i.push("<li"+jade.attr("id","work_"+u.id,!0,!1)+' class="followee-suggestion u-ph6x u-pb6x close-container">'),n.media(u),i.push('<div class="u-tcGrayDark u-fs12 u-lineHeight1_3 u-displayInlineBlock u-pv2x">by&nbsp;'+jade.escape(null==(e=u.authors[0].display_name)?"":e)+"</div></li>")}}}.call(this),i.push("</ul>")}.call(this,"suggestions"in s?s.suggestions:"undefined"!=typeof suggestions?suggestions:void 0,"undefined"in s?s.undefined:void 0),i.join("")}}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestionListView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(t){return i.__super__.initialize.apply(this,arguments),this.template=JST[t.template],this.suggestions=t.suggestions,this._renderOnSync(),this._rerenderOnRemoval(),this},i.prototype.render=function(){var t;return t=this.suggestions.displayable(4),t.length>0?(this.$el.html(this.template({suggestions:t})),this._truncate(),this._addHoverBehavior(t)):this.$el.html("<div class='u-ph6x u-mb6x u-tcGrayDark'>No results found.</div>")},i.prototype._truncate=function(){return this.$(".js-sidebar-truncate").each(function(){var t;return t=$(this),t.trunk8({lines:t.data("sidebar-truncate-to-lines"),tooltip:!0})})},i.prototype._addHoverBehavior=function(t){return _(t).each(function(t){return function(e){var i;return i=t._suggestionElement(e),i&&!i.data("expander")?i.data("expander",new SidebarSuggestions.SuggestionExpander({el:i})):void 0}}(this))},i.prototype._renderOnSync=function(){return this.listenTo(this.suggestions,"sync error",function(t){return function(){return t.render()}}(this))},i.prototype._rerenderOnRemoval=function(){return this.listenTo(this.suggestions,"remove",function(t){return function(e){var i,n;return i=t._suggestionElement(e),i&&(n=i.data("expander"))?n.collapse(function(){return t.render()}):t.render()}}(this))},i.prototype._suggestionElement=function(t){return this.$("*[data-suggestion-id="+t.get("id")+"]")},i}(Backbone.View)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.AffiliationModalController=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="sidebar_suggestions/templates/suggested_affiliation",i.prototype.events={"click .js-news-sidebar-add-affiliation":"openEditor"},i.prototype.initialize=function(){var t;return t=$r.api_v0_suggestions_affiliation_path({subdomain_param:"api"}),$.get(t).done(function(t){return function(e){return e.department?(t.guessedAffiliation=t.getGuessedAffiliation(e),t.render()):void 0}}(this))},i.prototype.render=function(){var t;if(this.universityName())return t=JST[this.template]({guessText:"Are you at "+this.universityName()+"?"}),this.$el.append(t),this.postRender()},i.prototype.postRender=function(){return this.ui={$addAffiliationModal:this.$(".js-news-add-affiliation-modal"),$addAffiliationModalBody:this.$(".js-newsfeed-add-affiliation-modal-body")},this.$el.removeClass("hidden")},i.prototype.universityName=function(){var t,e;return null!=(t=this.guessedAffiliation.get("department"))&&null!=(e=t.university)?e.name:void 0},i.prototype.openEditor=function(){var t;return t=new AffiliationEditor.AffiliationEditView({cancelClass:"Button Button--inverseGray Button--lg Button--halfBlock",cancelAction:function(t){return function(){return t.ui.$addAffiliationModal.modal("hide"),Kale.notify({collectionName:"newsfeed",eventData:{event:"news_feed_affiliation_cancel"}})}}(this),saveClass:"Button Button--green Button--lg Button--halfBlock u-floatRight",saveAction:function(){return Kale.notify({collectionName:"newsfeed",eventData:{event:"news_feed_affiliation_save"}}),window.location.reload()},alwaysPrimary:!0,model:this.guessedAffiliation}),this.ui.$addAffiliationModalBody.append(t.el),this.ui.$addAffiliationModal.modal({show:!0,backdrop:!0,keyboard:!0}),this.ui.$addAffiliationModal.on("hide.bs.modal",function(){return t.remove()}),Kale.notify({collectionName:"newsfeed",eventData:{event:"news_feed_affiliation_open"}})},i.prototype.getGuessedAffiliation=function(t){var e,i,n,s;return n=new Backbone.Model(t),e=new Backbone.Model(Aedu.User.current.affiliation()),i=n.get("department"),i.university||(i=null),s=n.get("position")||this.nullPosition,e.set({department:i,position:s})},i.prototype.nullPosition={id:1},i}(Backbone.View)}.call(this),function(){SidebarSuggestions.CertificationSuggestions=function(){function t(t){this.suggestions=new SidebarSuggestions.SuggestedCertifications,this.suggestions.ensureMinDisplayable(8),this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions}),this._listenForAccept()}return t.prototype.template="sidebar_suggestions/templates/suggested_certifications",t.prototype._listenForAccept=function(){return $(document).on("certification-created",function(t){return function(e,i){return t.suggestions.remove(t.suggestions.findWhere({id:i}))}}(this))},t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.CoauthorSuggestionListView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.tagName="ul",i.prototype.className="list-unstyled",i.prototype.render=function(){var t,e,i,n,s,o,r;for(0===this.$el.find("ul").length&&this.$el.html(this.template()),s=this.suggestions.displayable(4),o=[],e=0,i=s.length;i>e;e++)r=s[e],0===this.$el.find("[data-suggestion-id='"+r.cid+"']").length?(t=new SidebarSuggestions.CoauthorSuggestionView({model:r}),n=t.render().el,this.$el.find("ul").append(n),o.push($(n).data("expander",new SidebarSuggestions.SuggestionExpander({el:$(n)})))):o.push(void 0);return o},i}(SidebarSuggestions.SuggestionListView)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.CoauthorSuggestionView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="sidebar_suggestions/templates/suggested_coauthor",i.prototype.tagName="li",i.prototype.className="coauthor-suggestion Panel-bodySegment u-p5x",i.prototype.attributes=function(){return{"data-suggestion-id":this.model.cid}},i.prototype.events={"click .js-coauthor-accept-coauthor":"acceptSuggestion","click .js-coauthor-reject-coauthor":"rejectSuggestion","click .js-coauthor-email":"coauthorEmailClicked"},i.prototype.render=function(){return this.$el.empty(),this.$el.append(JST[this.template]({coauthor:this.model})),this},i.prototype.acceptSuggestion=function(){var t;return t=this.model.saveSuggestion(!0),t.done(function(t){return function(){return t.remove()}}(this)),t.fail(function(t){return function(){return t.alertError()}}(this))},i.prototype.rejectSuggestion=function(){var t;return t=this.model.saveSuggestion(!1),t.done(function(t){return function(){return t.remove()}}(this)),t.fail(function(t){return function(){return t.alertError()}}(this))},i.prototype.coauthorEmailClicked=function(t){return t.stopPropagation()},i.prototype.alertError=function(){return alert("Oops! We encountered an error and failed to process your request.")},i.prototype.remove=function(){return i.__super__.remove.apply(this,arguments),this.model.collection.remove(this.model)},i}(Backbone.View)}.call(this),function(){SidebarSuggestions.CoauthorSuggestions=function(){function t(t){this.suggestions=new SidebarSuggestions.SuggestedCoauthors,this.suggestions.fetch(),this.view=new SidebarSuggestions.CoauthorSuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions})}return t.prototype.template="sidebar_suggestions/templates/suggested_coauthors",t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.DiscussionSuggestionListView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.tagName="ul",i.prototype.className="list-unstyled",i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t)},i.prototype.render=function(){return i.__super__.render.apply(this,arguments),this.suggestions.each(function(t){return function(e){var i;return i=new SidebarSuggestions.DiscussionSuggestionView({model:e}),t.$el.find("ul").append(i.render().el),i.postRender()}}(this)),this},i}(SidebarSuggestions.SuggestionListView)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.DiscussionSuggestionView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template="sidebar_suggestions/templates/suggested_discussion",i.prototype.tagName="li",i.prototype.className="discussion-suggestion Panel-bodySegment u-p5x",i.prototype.attributes=function(){return{"data-suggestion-id":this.model.get("id")}},i.prototype.render=function(){return this.$el.empty(),this.$el.append(JST[this.template]({suggestion:this.model.toJSON()})),this},i.prototype.postRender=function(){return this.$(".js-suggested-discussion-name").trunk8({lines:2,tooltip:!1})},i}(Backbone.View)}.call(this),function(){SidebarSuggestions.DiscussionSuggestions=function(){function t(t){this.discussion_suggestions=new SidebarSuggestions.SuggestedDiscussions,this.discussion_suggestions.ensureMinDisplayable(1),this.view=new SidebarSuggestions.DiscussionSuggestionListView({el:t.el,template:this.template,suggestions:this.discussion_suggestions})}return t.prototype.template="sidebar_suggestions/templates/suggested_discussions",t}()}.call(this),function(){SidebarSuggestions.HistorySuggestions=function(){function t(t){this.suggestions=new SidebarSuggestions.SuggestedHistorys,this.suggestions.ensureMinDisplayable(8),this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions})}return t.prototype.template="sidebar_suggestions/templates/suggested_history",t}()}.call(this),function(){SidebarSuggestions.InterestSuggestions=function(){function t(t){this.suggestions=new SidebarSuggestions.SuggestedInterests,this.suggestions.ensureMinDisplayable(8),this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions}),this._listenForAcceptOrReject()}return t.prototype.template="sidebar_suggestions/templates/suggested_interests",t.prototype._listenForAcceptOrReject=function(){return this._loadTaggings(),$(document).on("click","*[data-follow-ri-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("follow-ri-id"),$("#ri_suggestion_"+i).fadeOut("slow",function(){var e;return e=t.suggestions.removeById(i)}),t._loadTaggings(function(){return this.taggings.tag({id:i},null,{auto:suggestion.sourceString()}),c.User.current.interests.push(suggestion.get("interest"))})}}(this)),$(document).on("click","*[data-unfollow-ri-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("unfollow-ri-id"),$("#ri_suggestion_"+i).fadeOut("slow",function(){return t.suggestions.removeById(i)}),t._loadTaggings(function(){return this.taggings.untag({id:i}),c.User.current.interests=_.reject(c.User.current.interests,function(t){return t.id===i})})}}(this)),$(document).on("click","*[data-ignore-suggested-ri-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("ignore-suggested-ri-id"),$("#ri_suggestion_"+i).fadeOut("slow",function(){var e;return null!=(e=t.suggestions.findWhere({id:i}))?e.destroy():void 0})}}(this))},t.prototype._loadTaggings=function(t){return req("new_profile",function(){return this.taggings||(this.taggings=new NewProfile.Taggings([],{tag_type:"ResearchInterest",target_type:"User",target_id:$current_user.id,tag_source:"sidebar_suggestion"})),"function"==typeof t?t():void 0})},t}()}.call(this),function(){SidebarSuggestions.JobSuggestions=function(){function t(t){this.suggestions=new SidebarSuggestions.SuggestedJobs,this.suggestions.ensureMinDisplayable(8),this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions}),this.broccoliNotifier=new Aedu.Broccoli({defaultCollection:"ads"})}return t.prototype.template="sidebar_suggestions/templates/suggested_jobs",t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestionExpander=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){return this.expanded=!1,i.__super__.initialize.apply(this,arguments),this.$expandedContent=this.$el.find(".js-expanded-content"),this},i.prototype.events={mouseenter:"expand",mouseleave:"collapse",click:"toggle"},i.prototype.expand=function(t){return this.expanded=!0,this.$expandedContent.removeClass("hidden").hide().slideDown(200,function(){return function(){return"function"==typeof t?t():void 0}}(this))},i.prototype.collapse=function(t){return this.expanded=!1,this.$expandedContent.slideUp(200,function(e){return function(){return e.$expandedContent.addClass("hidden"),"function"==typeof t?t():void 0}}(this))},i.prototype.toggle=function(){return this.expanded?this.collapse():this.expand()},i}(Backbone.View)}.call(this),function(){SidebarSuggestions.UserSuggestions=function(){function t(t){var e;this.suggestions=new SidebarSuggestions.SuggestedUsers([],12),this.suggestions.ensureMinDisplayable(8),e="old"===window.newsfeed_sidebar_redesign_ab_test?this.template:this.template_v2,this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:e,suggestions:this.suggestions}),this._listenForAcceptOrReject()}return t.prototype.template="sidebar_suggestions/templates/suggested_users",t.prototype.template_v2="sidebar_suggestions/templates/suggested_users_v2",t.prototype._listenForAcceptOrReject=function(){return $(document).on("click","*[data-follow-user-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("follow-user-id"),$("#user_suggestion_"+i).fadeOut("slow",function(){return t.suggestions.remove(t.suggestions.findWhere({id:i}))})}}(this)),$(document).on("click","*[data-unfollow-user-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("unfollow-user-id"),$("#user_suggestion_"+i).fadeOut("slow",function(){return t.suggestions.remove(t.suggestions.findWhere({id:i}))})}}(this)),$(document).on("click","*[data-ignore-suggested-user-id]",function(t){return function(e){var i;return i=$(e.currentTarget).data("ignore-suggested-user-id"),$("#user_suggestion_"+i).fadeOut("slow",function(){var e;return null!=(e=t.suggestions.findWhere({id:i}))?e.destroy():void 0})}}(this))},t}()}.call(this),function(){SidebarSuggestions.WorkSuggestions=function(){function t(t){null==t&&(t={}),this.suggestions=t.suggestions,this.suggestions.ensureMinDisplayable(3),this.broccoliCollection=t.broccoliCollection,this.view=new SidebarSuggestions.SuggestionListView({el:t.el,template:this.template,suggestions:this.suggestions}),this.broccoliCollection&&(this.broccoliNotifier=new Aedu.Broccoli({defaultCollection:this.broccoliCollection}),this.broccoliNotifier.notify("trending-works__viewed"))}return t.prototype.template="sidebar_suggestions/templates/suggested_works",t}()}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedCoauthors=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedCoauthor,i.prototype.url=$r.api_v0_suggestions_coauthors_path({subdomain_param:"api"}),i.prototype.parse=function(t){return t},i.prototype.displayable=function(t){return this.slice(this.length-t,this.length)},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.SuggestedJobs=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.SuggestedJob,i.prototype.url=$r.randomized_last_api_v0_suggestions_jobs_path({subdomain_param:"api"}),i.prototype.parse=function(t){return null==(null!=t?t.jobs:void 0)?[]:_(t.jobs).map(function(t){return new SidebarSuggestions.SuggestedJob({job:t})})},i.prototype.displayable=function(){return this.filter(function(){return!0})},i}(SidebarSuggestions.SuggestionsCollection)}.call(this),function(){var t=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;SidebarSuggestions.TrendingWorks=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=SidebarSuggestions.TrendingWork,i.prototype.initialize=function(t,e){return this.url=$r.trending_api_v0_suggestions_works_path({subdomain_param:"api",research_interest_id:e.research_interest_id,work_id:e.work_id}),i.__super__.initialize.apply(this,arguments)},i.prototype.parse=function(t){return null==(null!=t?t.works:void 0)?[]:_(t.works).map(function(t){return new SidebarSuggestions.TrendingWork({work:t})})},i.prototype.displayable=function(){return this.filter(function(){return!0})},i}(SidebarSuggestions.SuggestionsCollection)}.call(this);